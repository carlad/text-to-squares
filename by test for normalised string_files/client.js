var DISQUS=function(a){var e={AssertionError:function(a){this.message=a}};e.AssertionError.prototype.toString=function(){return"Assertion Error: "+(this.message||"[no message]")};e.assert=function(a,f){if(!a)throw new e.AssertionError(f);};var i=[];e.define=function(j,f){typeof j==="function"&&(f=j,j="");for(var d=j.split("."),c=d.shift(),g=e,o=(f||function(){return{}}).call({overwrites:function(c){c.__overwrites__=!0;return c}},a);c;)g=g[c]?g[c]:g[c]={},c=d.shift();for(var k in o)o.hasOwnProperty(k)&&
(o.__overwrites__||g[k]!==null&&e.assert(!g.hasOwnProperty(k),"Unsafe attempt to redefine existing module with "+k),g[k]=o[k],i.push(function(c,g){return function(){delete c[g]}}(g,k)));return g};e.use=function(a){return e.define(a)};e.cleanup=function(){for(var a=0;a<i.length;a++)i[a]()};return e}(this);
DISQUS.define(function(a,e){var i=a.document,j=i.getElementsByTagName("head")[0]||i.body,f={running:!1,timer:null,queue:[]};DISQUS.defer=function(d,c){function g(){var c=f.queue;if(c.length===0)f.running=!1,clearInterval(f.timer);for(var g=0,d;d=c[g];g++)d[0]()&&(c.splice(g--,1),d[1]())}f.queue.push([d,c]);g();if(!f.running)f.running=!0,f.timer=setInterval(g,100)};DISQUS.each=function(d,c){var g=d.length,a=Array.prototype.forEach;if(isNaN(g))for(var f in d)d.hasOwnProperty(f)&&c(d[f],f,d);else if(a)a.call(d,
c);else for(a=0;a<g;a++)c(d[a],a,d)};DISQUS.extend=function(d){DISQUS.each(Array.prototype.slice.call(arguments,1),function(c){for(var g in c)d[g]=c[g]});return d};DISQUS.serializeArgs=function(d){var c=[];DISQUS.each(d,function(g,d){g!==e&&c.push(d+(g!==null?"="+encodeURIComponent(g):""))});return c.join("&")};DISQUS.isString=function(d){return Object.prototype.toString.call(d)==="[object String]"};DISQUS.serialize=function(d,c,g){c&&(d+=~d.indexOf("?")?d.charAt(d.length-1)=="&"?"":"&":"?",d+=DISQUS.serializeArgs(c));
if(g)return c={},c[(new Date).getTime()]=null,DISQUS.serialize(d,c);c=d.length;return d.charAt(c-1)=="&"?d.slice(0,c-1):d};DISQUS.require=function(d,c,g,a,f){function e(c){if(c.type=="load"||/^(complete|loaded)$/.test(c.target.readyState))a&&a(),q&&clearTimeout(q),DISQUS.bean.remove(c.target,l,e)}var m=i.createElement("script"),l=m.addEventListener?"load":"readystatechange",q=null;m.src=DISQUS.serialize(d,c,g);m.async=!0;m.charset="UTF-8";(a||f)&&DISQUS.bean.add(m,l,e);f&&(q=setTimeout(function(){f()},
2E4));j.appendChild(m);return DISQUS};DISQUS.requireStylesheet=function(d,c,g){var a=i.createElement("link");a.rel="stylesheet";a.type="text/css";a.href=DISQUS.serialize(d,c,g);j.appendChild(a);return DISQUS};DISQUS.requireSet=function(d,c,g){var a=d.length;DISQUS.each(d,function(d){DISQUS.require(d,{},c,function(){--a===0&&g()})})};DISQUS.injectCss=function(d){var c=i.createElement("style");c.setAttribute("type","text/css");d=d.replace(/\}/g,"}\n");a.location.href.match(/^https/)&&(d=d.replace(/http:\/\//g,
"https://"));c.styleSheet?c.styleSheet.cssText=d:c.appendChild(i.createTextNode(d));j.appendChild(c)}});
DISQUS.define("JSON",function(){function a(c){return c<10?"0"+c:c}function e(g){c.lastIndex=0;return c.test(g)?'"'+g.replace(c,function(c){var g=k[c];return typeof g==="string"?g:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function i(c,d){var a,j,k,l,m=g,r,n=d[c];n&&typeof n==="object"&&typeof n.toJSON==="function"&&!f&&(n=n.toJSON(c));typeof p==="function"&&(n=p.call(d,c,n));switch(typeof n){case "string":return e(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";g+=o;r=[];if(Object.prototype.toString.apply(n)==="[object Array]"){l=n.length;for(a=0;a<l;a+=1)r[a]=i(a,n)||"null";k=r.length===0?"[]":g?"[\n"+g+r.join(",\n"+g)+"\n"+m+"]":"["+r.join(",")+"]";g=m;return k}if(p&&typeof p==="object"){l=p.length;for(a=0;a<l;a+=1)j=p[a],typeof j==="string"&&(k=i(j,n))&&r.push(e(j)+(g?": ":":")+k)}else for(j in n)Object.hasOwnProperty.call(n,j)&&(k=i(j,n))&&r.push(e(j)+(g?": ":":")+k);k=r.length===0?"{}":g?"{\n"+g+r.join(",\n"+g)+"\n"+
m+"}":"{"+r.join(",")+"}";g=m;return k}}var j={},f=!1;if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,o,k={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;j.stringify=function(c,d,a){var f;o=g="";if(typeof a==="number")for(f=0;f<a;f+=1)o+=" ";else typeof a==="string"&&(o=a);if((p=d)&&typeof d!=="function"&&(typeof d!=="object"||typeof d.length!=="number"))throw Error("JSON.stringify");return i("",{"":c})};j.parse=function(c,g){function a(c,
d){var f,r,n=c[d];if(n&&typeof n==="object")for(f in n)Object.hasOwnProperty.call(n,f)&&(r=a(n,f),r!==void 0?n[f]=r:delete n[f]);return g.call(c,d,n)}var f,c=String(c);d.lastIndex=0;d.test(c)&&(c=c.replace(d,function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(c.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+c+")"),
typeof g==="function"?a({"":f},""):f;throw new SyntaxError("JSON.parse");};var m={a:[1,2,3]},l,q;if(Object.toJSON&&Object.toJSON(m).replace(/\s/g,"")==='{"a":[1,2,3]}')l=Object.toJSON;typeof String.prototype.evalJSON==="function"&&(m='{"a":[1,2,3]}'.evalJSON(),m.a&&m.a.length===3&&m.a[2]===3&&(q=function(c){return c.evalJSON()}));(function(){var c=[1,2,3];typeof c.toJSON==="function"&&(c=c.toJSON(),f=!(c&&c.length===3&&c[2]===3))})();if(f||!l||!q)return{stringify:j.stringify,parse:j.parse};return{stringify:l,
parse:q}});
DISQUS.define("Bus",function(){function a(c){c=c.split("/");return c[0]+"//"+c[2]}var e=DISQUS.use("JSON"),i=window.location.hash.slice(1),j=window.parent,f=document.referrer,d={};d.client=a(document.location.href);d.host=f?a(f):d.client;return{origins:d,postMessage:function(c){c.sender=i;c=e.stringify(c);j.postMessage(c,d.host)},sendHostMessage:function(c,g){g=g||[];DISQUS.Bus.postMessage({scope:"host",name:c,data:g})},sendGlobalMessage:function(c,g){g=g||[];DISQUS.Bus.postMessage({scope:"global",name:c,
data:g})}}});_.extend(DISQUS.Bus,Backbone.Events);$(document).ready(function(){var a=window.addEventListener?window.addEventListener:window.attachEvent,e=window.addEventListener?"message":"onmessage";if(!a)throw Error("No event support.");a(e,function(a){var e=DISQUS.Bus,f=a.origin;if(!(f!=e.origins.client&&f!=e.origins.host)){var d;try{d=DISQUS.JSON.parse(a.data)}catch(c){return}a=d.data;switch(d.scope){case "client":e.trigger(a.eventName,a.data)}}},!1)});
DISQUS.define(function(){var a={blocks:{},ISO_8601:"YYYY-MM-DDTHH:mm:ssZ",apiKey:"E8Uh5l5fHZ6gD8U3KycjAIAk46f68Zw7C6eW8WSjZvCLXebZ7p0r1yrYDrLilk2F",bean:require("bean"),debug:!1,browser:{mobile:navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i)},addBlocks:function(){return function(a){a(DISQUS)}}};a.templateGlobals={urls:DISQUS.use("urls"),sso:null,_:{pluralize:_.pluralize}};a.renderBlock=function(e,j){return DISQUS.blocks[e](a.templateGlobals,j)};a.assureOffset=function(a){return a.indexOf("+")>=
0?a:a+"+00:00"};var e=a.Builder=function(){this.accum=[]};_.extend(e.prototype,{put:function(a){this.accum.push(a)},esc:function(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},compile:function(){return this.accum.join("")}});return a});
DISQUS.define("urls",function(){var a=encodeURIComponent(document.referrer),e={root:"http://disqus.com",media:"http://mediacdn.disqus.com/1346444993",loading:"http://mediacdn.disqus.com/1346444993/html/simple-loading.html",realertime:"http://realtime.services.disqus.com",login:"https://disqus.com/next/login/",api:"http://disqus.com/api/3.0/",apiSecure:"https://disqus.com/api/3.0/",logout:"http://disqus.com/logout/?redirect="+a,editProfile:"http://disqus.com/account/",verifyEmail:"https://disqus.com/next/verify/",
authorize:"https://disqus.com/api/oauth/2.0/authorize/",moderate:"http://disqus.com/admin/moderate/",oauth:{twitter:"http://disqus.com/_ax/twitter/begin/",google:"http://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"http://mediacdn.disqus.com/1346444993/images/noavatar92.png"}};window.location.protocol==="https:"&&(e=_.extend(e,{root:"https://disqus.com",media:"https://securecdn.disqus.com/1346444993",loading:"https://securecdn.disqus.com/1346444993/html/simple-loading.html",
realertime:e.realertime.replace("http://","https://"),api:e.apiSecure,logout:"https://disqus.com/logout/?redirect="+a,editProfile:"https://disqus.com/account/",moderate:"https://disqus.com/admin/moderate/",oauth:{twitter:"https://disqus.com/_ax/twitter/begin/",google:"https://disqus.com/_ax/google/begin/",facebook:"http://disqus.com/_ax/facebook/begin/"},avatar:{generic:"https://securecdn.disqus.com/1346444993/images/noavatar92.png"}}));return e});
DISQUS.define("api",function(){function a(a){function f(c){var e=c.originalEvent.origin;DISQUS.urls.apiSecure.slice(0,e.length)===e&&(c=DISQUS.JSON.parse(c.originalEvent.data),c.requestId==d&&(e=c.code===0?a.success:a.error,delete c.requestId,(e||function(){})(c),document.body.removeChild(k),document.body.removeChild(g),$(window).unbind("message",f)))}var d=_.uniqueId(),c=document.createElement("div"),g=document.createElement("form"),e="frame_"+d,k;c.innerHTML='<iframe name="'+e+'"></iframe>';k=c.childNodes[0];
g.target=e;g.action=a.url.replace(".json",".pm");g.method=a.method||"GET";a.data=_.extend(a.data,{callback:d,referrer:document.referrer});_.each(a.data,function(c,a){c===!0?c=[1]:c===!1?c=[0]:c===null?c=[""]:_.isArray(c)||(c=[c]);_.each(c,function(c){var d=document.createElement("input");d.type="hidden";d.name=a;d.value=c;g.appendChild(d)})});$(window).bind("message",f);document.body.appendChild(k);document.body.appendChild(g);g.submit()}function e(a){a=_.defaults(a,i);a.data=a.data||{};a.data.api_key=
DISQUS.apiKey;$.ajax(a)}var i={};return{defaults:function(a){_.extend(i,a)},getURL:function(a,f){f=f||{};if(f.secure||window.location.protocol==="https:")return DISQUS.urls.apiSecure+a;return DISQUS.urls.api+a},ajax:e,call:function(i,f){f=f||{};f.url=DISQUS.api.getURL(i,{secure:f.secure});f.data=_.extend(f.data||{},{api_key:DISQUS.apiKey});(f.secure?a:e)(f)}}});
(function(a){a.ajax=function(a){a.method=a.type;a.type=a.dataType;delete a.dataType;return DISQUS.api.ajax(a)};a.Collection.prototype.parse=function(a){return a.response}})(Backbone);
DISQUS.define("cookies",function(){return{create:function(a,e,i){a=a+"="+e+"; path=/";i.domain&&(a+="; domain=."+i.domain);i.expiresIn&&(e=new Date,e.setTime(e.getTime()+i.expiresIn),a+="; expires="+e.toGMTString());document.cookie=a},read:function(a){a+="=";for(var e=document.cookie.split(";"),i,j=0;j<e.length;j++){for(i=e[j];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(a)===0)return i.substring(a.length,i.length)}return null},erase:function(a,e){var i=new Date;i.setTime(i.getTime()+
-864E5);i=a+"=; path=/;expires="+i.toGMTString();e.domain&&(i+="; domain=."+e.domain);document.cookie=i}}});
DISQUS.define("lounge.utils",function(){function a(c){function a(c){c=Number(c).toString(16);return c.length==1?"0"+c:c}if(c.substr(0,1)==="#")return c;var d=/.*?rgb\((\d+),\s*(\d+),\s*(\d+)\)/.exec(c);if(!d||d.length!==4)return"";var c=a(d[1]),f=a(d[2]),d=a(d[3]);return"#"+c+f+d}var e=RegExp("[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E\\u00A1-\\u00BF\\u2010-\\u2027\\u2030-\\u205E\\u2300-\\u23FF\\u2E00-\\u2E7F\\u3001-\\u303F\\uFE10-\\uFE19\\uFE30-\\uFE4F\\uFE50-\\uFE6B\\uFF01-\\uFF0F\\uFF1A-\\uFF20\\uFF3B-\\uFF40\\uFF5B-\\uFF60\\uFF5F-\\uFF64]+$"),i=
{domain:DISQUS.urls.root.split("/")[2],create:function(c,a){DISQUS.cookies.create(c,a,{domain:i.domain,expiresIn:31536E6})},read:DISQUS.cookies.read,erase:function(c){DISQUS.cookies.erase(c,{domain:i.domain})}},j=function(){var c={};return{getItem:function(a){return c.hasOwnProperty(a)?c[a]:null},setItem:function(a,d){c[a]=String(d)},removeItem:function(a){delete c[a]}}}(),f=/^[a-z0-9_.%+\-]+@[0-9a-z.\-]+\.[a-z.]{2,6}$/i,d=function(){function c(){this.state=null;this.queue=[]}_.extend(c.prototype,
{highlight:function(c){this.state===null&&this._load();this.queue.push(c);this.state===2&&this._flush()},_load:function(){var c=this;c.state=1;DISQUS.require("http://mediacdn.disqus.com/1346444993/build/js/highlight.js",{},!1,function(){c.state=2;c._flush()})},_flush:function(){_.chainedDefer(this.queue,function(c){var a=$(c).html();$(c).html(a.replace(/^<br>/,""));hljs.highlightBlock(c)},this)}});return new c}();return{attempt:function(c,a){try{_.bind(c,a||{})()}catch(d){return d}return null},extract:function(c,
a){for(var d=a.split("."),f=d.shift();f;){if(d.length===0)return c[f];if(!_.isObject(c[f]))return;c=c[f];f=d.shift()}return c},addStylesheetRules:function(c){function a(){var f=_.find(document.styleSheets,function(c){return(c.ownerNode||c.owningElement).id===d});if(!f)return void setTimeout(a,50);for(var e=0,i=c.length;e<i;e++){var j=1,k=c[e],t=k[0],w="";Object.prototype.toString.call(k[1][0])==="[object Array]"&&(k=k[1],j=0);for(var A=k.length;j<A;j++){var y=k[j];w+=y[0]+":"+y[1]+(y[2]?" !important":
"")+";\n"}f.insertRule?f.insertRule(t+"{"+w+"}",f.cssRules.length):f.addRule(t,w,-1)}}var d="css_"+(new Date).getTime(),f=document.createElement("style");f.id=d;document.getElementsByTagName("head")[0].appendChild(f);window.createPopup||f.appendChild(document.createTextNode(""));a()},escapeColor:function(c){return a(c).replace(/[^#A-Fa-f0-9]/g,"")},makeCORSRequest:function(c,a,d){d=d||function(){};if(typeof XMLHttpRequest=="undefined")return null;var f=new XMLHttpRequest;if("withCredentials"in f)f.open(c,
a,!0),f.onreadystatechange=d;else if(typeof XDomainRequest!="undefined"){if(c!=="GET"&&c!=="POST")return null;f=new XDomainRequest;f.open(c,a);f.onload=d}else f=null;return f},hashStorage:j,cookies:i,niceTruncate:function(c,a){if(c.length<=a)return c;var d=c=c.slice(0,a-1),f=/(^.*\S)\s/.exec(c);f&&(c=f[1]);(f=e.exec(c))&&(c=c.slice(0,c.length-f[0].length));c.length<0.5*d.length&&(c=d);return c+"\u2026"},htmlDecode:function(c){var a=document.createElement("div");a.innerHTML=c;return a.childNodes.length===
0?"":a.childNodes[0].nodeValue},isWindowClosed:function(c){if(!c)return!0;try{return c.closed||c.closed===void 0}catch(a){return!0}},validateEmail:function(c){return f.test(c)},updateURL:function(c,a){var d=document.createElement("a"),a=a||{};d.href=c;a.hostname&&a.hostname.match(/\.$/)&&(a.hostname+=d.hostname);d=_.extend({protocol:d.protocol,hostname:d.hostname,pathname:d.pathname,search:d.search},a);if(!d.pathname.match(/^\//))d.pathname="/"+d.pathname;return d.protocol+"//"+d.hostname+d.pathname+
d.search},syntaxHighlighter:d}});
DISQUS.define("lounge.realtime",function(){function a(a){this.url=a+"?"+ +new Date;this.xhr=null;this.len=0}function e(a){this.uid=+new Date;this.url=a;this.main=null;this.data=[];this.c1=new i("c1",a+"?"+this.uid+"_c1");this.c2=new i("c2",a+"?"+this.uid+"_c2");this.chaos=!1;this.interval=1;_([this.c1,this.c2]).each(_.bind(function(a){a.on("progress",this.onProgress,this);a.on("error",this.onError,this);a.on("success",this.onSuccess,this)},this))}function i(a,d){this.name=a;this.url=d;this.xhr=null}
var j=DISQUS.use("lounge.utils");_.extend(a.prototype,Backbone.Events,{onLoad:function(){var a=this.xhr;a.readyState!==void 0&&a.readyState!=4||a.status!==void 0&&a.status!==200||this.trigger("success")},onError:function(){this.trigger("error")},onProgress:function(){var a=this,d=a.xhr.responseText,c=0;d&&a.len!==d.length&&(d=d.slice(a.len).split("\n"),_.each(d,function(d){c+=d.length+1;try{d=JSON.parse(d)}catch(e){c-=d.length+1;return}a.trigger("progress",d)}),a.len+=c)},run:function(){var a=this;
a.xhr=j.makeCORSRequest("GET",a.url,function(){a.onLoad()});a.xhr.onerror=function(){a.onError()};a.xhr.onprogress=function(){a.onProgress()};try{a.xhr.send()}catch(d){DISQUS.log("Attempt to send a CORS request failed.")}}});_.extend(e.prototype,Backbone.Events,{run:function(a){a=a||"c1";if(!(this.chaos&&a!=="c1"))this.main=a,this[a].run(),DISQUS.log("RT: started a new connection "+a),this.chaos?(DISQUS.logError("RT: chaos mode"),this.interval<=120&&(this.interval*=2),_.delay(_.bind(this.run,this,
"c1"),85E3,"c1")):_.delay(_.bind(this.run,this,a=="c1"?"c2":"c1"),85E3)},onProgress:function(a,d){this.main===a&&this.trigger("progress",d)},onError:function(){this.chaos=!0},onSuccess:function(){this.chaos=!1}});_.extend(i.prototype,Backbone.Events,{run:function(){var a=this,d=0,c;c=j.makeCORSRequest("GET",a.url,function(){c.readyState!==void 0&&c.readyState!==4||(c.status!==void 0&&c.status!==200&&a.trigger("error"),a.trigger("success"))});c.onerror=function(){a.trigger("error")};c.onprogress=function(){if(c.responseText){var e=
c.responseText.split("\n"),i,k;if(e.length!==d)for(;d<e.length;){if(i=j.attempt(function(){k=JSON.parse(e[d])}))break;d+=1;a.trigger("progress",a.name,[k])}}};c.send();a.xhr=c}});return{Firehose:a,Pool:e,Connection:i}});
DISQUS.define("lounge.models",function(){function a(c,d,e){var f=a.pool[c.__type__],g=d&&d[c.prototype.idAttribute];if(!f)throw Error("Model not registered. Use UniqueModel.addType");if(!g)return new c(d,e);f[g]?f[g].set(d):f[g]=new c(d,e);return f[g]}var e=DISQUS.use("lounge.collections"),i=DISQUS.use("lounge.utils"),j=DISQUS.use("Bus");a.pool={};a.addType=function(c,d){if(!d.__type__||!a.pool[c])d.__type__=c,a.pool[c]={}};var f=Backbone.Model.extend({defaults:{settings:{}}}),d=Backbone.Model.extend({defaults:{author:null,
category:null,createdAt:null,forum:null,identifiers:[],ipAddress:null,isClosed:!1,isDeleted:!1,hasStreaming:!1,link:null,message:null,slug:null,title:null,userSubscription:!1,posts:0,reactions:0,likes:0,dislikes:0,userScore:0},initialize:function(a,c){var d=this,c=c||{};d.moderators=c.moderators;d.forum=c.forum;d.users=new e.UserCollection(c.users,{thread:d});d.posts=new e.PostCollection(c.posts,{thread:d,cursor:c.postCursor});d.reactions=new e.ReactionsCollection(null,{thread:d});d.votes=new e.ThreadVoteCollection;
d.posts.bind("add reset",function(a){a=a.models?a.models:[a];_.each(a,function(a){d.users.get(a.author.id)||d.users.add(a.author)})});d.posts.bind("destroy",function(){d.set("posts",d.get("posts")-1)});d.bind("change:posts",d.broadcastPostCount,d);d.queue=new e.QueuedPostCollection(null,{thread:d})},_vote:function(a,c){var d=a-c;if(d===0)return d;this.set("likes",this.get("likes")+d);return d},vote:function(a){var c=this;c._vote(a,c.get("userScore"))!==0&&(this.set("userScore",a),DISQUS.api.call("threads/vote.json",
{data:{thread:this.id,vote:a},method:"POST",success:function(d){d.response.id&&(c.votes.get(d.response.id)||c.votes.add({id:d.response.id,score:a}))}}))},broadcastPostCount:function(){j.sendGlobalMessage("lounge.updateCounter",{count:this.get("posts")})},fetch:function(a){var c=this,d=c.attributes,a=a||{};DISQUS.api.call("threads/details.json",{data:{thread:d.identifier?"ident:"+d.identifier:"link:"+d.url,forum:d.forum},success:function(d){c.set(d.response);a.success&&a.success()},error:function(){DISQUS.debug?
c.save({},{success:a.success}):console.log("Couldn't find thread; not creating in production.")}})},_toggleState:function(a,c){c||(c={});var d=a?"open.json":"close.json";this.set("isClosed",!a);DISQUS.api.call("threads/"+d,{method:"POST",data:{thread:this.id},success:c.success,error:c.error})},open:function(a){this._toggleState(!0,a)},close:function(a){this._toggleState(!1,a)},sync:function(){var a=this,c=a.attributes;DISQUS.api.call("threads/create.json",{data:{title:c.title,forum:c.forum,identifier:c.identifier,
url:c.url},method:"POST",success:function(c){a.set(c.response)}})},incrementPostCount:function(a){this.set("posts",this.get("posts")+a)},isModerator:function(a){if(this.moderators)return a=a instanceof l||_.isObject(a)?a.id:a,a=parseInt(a,10),_(this.moderators).contains(a)},subscribe:function(a,c){var a=a!==!1,d=this.get("userSubscription");if(d!=a){a?this.set("userSubscription",c||!0):this.set("userSubscription",!1);var e={thread:this.id};if(c)e.email=c;else if(!a&&typeof d==="string")e.email=d;
DISQUS.api.call("threads/"+(a?"subscribe.json":"unsubscribe.json"),{data:e,method:"POST"})}},relatedIds:function(){var a=this.get("forum");_.isObject(a);return{forum:this.get("forum"),thread:this.id}},twitterText:function(a){var a=140-(a.length+1),c=DISQUS.lounge.utils.htmlDecode(this.get("title"));return c=DISQUS.lounge.utils.niceTruncate(c,a)},url:function(){var a=this.get("url")||this.get("link");if(!a&&this.currentUrl)a=this.currentUrl;return a}}),c=d.extend({defaults:_.extend({postsInInterval:0,
topPost:null},d.prototype.defaults)}),g=Backbone.Model.extend({defaults:function(){return{createdAt:moment().format(DISQUS.ISO_8601),dislikes:0,isApproved:!0,isDeleted:!1,isEdited:!1,isFlagged:!1,isHighlighted:!1,isRealtime:!1,isImmediateReply:!1,isMinimized:null,message:null,raw_message:null,likes:0,media:[],points:0,depth:0,userScore:0}},initialize:function(){this.votes=new e.VoteCollection;this.usersTyping=new e.TypingUserCollection},set:function(c,d,e){if(c&&typeof c!=="string"&&c.author)this.author=
new a(l,c.author),delete c.author;return Backbone.Model.prototype.set.call(this,c,d,e)},messageText:function(){var a=this.get("message");return _.strip(a)},relatedIds:function(){var a=this.get("forum");if(_.isObject(a))a=a.id;var c=this.get("thread");if(_.isObject(c))c=c.id;return{forum:a,thread:c,post:this.id}},twitterText:function(a){var c=140,d;d=this.author.get("name")||this.author.get("username");c-=d.length+3;c-=a.length+1;c-=2;a=this.messageText();a=DISQUS.lounge.utils.niceTruncate(a,c);return'"'+
a+'" \u2014 '+d},getRelativeCreatedAt:function(){var a=this.get("createdAt");if(a)return a=DISQUS.assureOffset(a),moment(a,DISQUS.ISO_8601).fromNow()},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this);a.isMinimized=this.get("isMinimized")===!1?!1:!this.get("isApproved");if(this.author)a.author=this.author.toJSON();a.relativeCreatedAt=this.getRelativeCreatedAt();return a},validate:function(a){if(!this.id&&!a.id){if(_.isString(a.raw_message)){if(a.raw_message==="")return"Comments can't be blank.";
if(a.raw_message.length<2)return"Comments must have at least 2 characters."}if(a.author_email===""&&a.author_name==="")return"Please sign in or enter a name and email address.";else if(a.author_email===""||a.author_name==="")return"Please enter both a name and email address.";if(_.isString(a.author_email)&&!i.validateEmail(a.author_email))return"Invalid email address format."}},report:function(){this.set("isFlagged",!0);DISQUS.api.call("posts/report.json",{data:{post:this.id},method:"POST"})},_vote:function(a,
c){function d(a){f.set("likes",f.get("likes")+a)}function e(a){f.set("dislikes",f.get("dislikes")+a)}var f=this,g=a-c;if(g===0)return g;f.set("points",f.get("points")+g);a>0?(d(a),e(c)):a<0?(e(-a),d(-c)):c>0?d(-c):e(c);return g},vote:function(a){var c=this;c._vote(a,c.get("userScore"))!==0&&(c.set("userScore",a),DISQUS.api.call("posts/vote.json",{data:{post:c.id,vote:a},method:"POST",success:function(a){c.votes.add({id:a.response.id})}}))},_delete:function(){this.set({isApproved:!1,isDeleted:!0});
DISQUS.api.call("posts/remove.json",{data:{post:this.id},method:"POST"})},spam:function(){this.set({isApproved:!1,isDeleted:!0,isSpam:!0});this.trigger("spam");DISQUS.api.call("posts/spam.json",{data:{post:this.id},method:"POST"})},_create:function(a,c){var d=this,e=a.attributes,f={thread:e.thread,message:e.raw_message};if(e.recaptcha_challenge_field)f.recaptcha_challenge_field=e.recaptcha_challenge_field,f.recaptcha_response_field=e.recaptcha_response_field;if(e.parent)f.parent=e.parent;if(e.author_name)f.author_name=
e.author_name,f.author_email=e.author_email;DISQUS.api.call("posts/create.json",{data:f,method:"POST",success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},_update:function(a,c){var d=this,e=a.attributes;DISQUS.api.call("posts/update.json",{data:{post:e.id,message:e.raw_message},method:"POST",success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},_read:function(a,c){var d=this,c=c||{};DISQUS.api.call("posts/details.json",{data:{post:d.id},method:"GET",
success:function(a){d.set(a.response);c.success&&c.success()},error:c.error})},sync:function(a,c,d){var d=d||{},e=d.error;if(e)d.error=function(a){e(JSON.parse(a.responseText||"{}"))};switch(a){case "create":this._create(c,d);break;case "update":this._update(c,d);break;case "delete":this._delete();break;case "read":this._read(c,d)}}});a.addType("Post",g);var o=Backbone.Model.extend({defaults:{userId:null,message:null,parentId:null,immedReply:!1},initialize:function(){this.set("createdAt",moment().format(DISQUS.ISO_8601))},
getVisibleParent:function(a){for(var c=this,d;c.get("parentId");){if(d=a.posts.get(c.get("parentId")))return d;c=a.queue.get(c.get("parentId"));if(!c)break}return null},toPost:function(c){var d=c.posts.get(this.get("parentId")),d=d?d.get("depth")+1:0,d=new a(g,{id:this.id,thread:c.id,message:this.get("message"),parent:this.get("parentId"),depth:d,createdAt:this.get("createdAt"),isRealtime:!0,isImmediateReply:this.get("immedReply")});d.author=c.users.get(this.get("userId"));return d}}),k=Backbone.Model.extend({defaults:{typing:!0},
initialize:function(){this.createdAt=moment()}}),p=Backbone.Model.extend({defaults:{about:null,avatar:{cache:DISQUS.urls.media+"/images/noavatar92.png",permalink:DISQUS.urls.media+"/images/noavatar92.png"},connections:{},email:null,emailHash:null,isAnonymous:!0,isFollowedBy:!1,isFollowing:!1,joinedAt:null,name:null,profileUrl:null,url:null,username:null,numPosts:null,numFollowing:null,numFollowers:null,numLikesReceived:null},hasValidAvatar:function(a){if(!a)a=this.attributes;return(a=a.avatar)&&a.cache&&
a.permalink},validate:function(a){if(!this.hasValidAvatar(a))return"None of the avatar related properties can be null, undefined or empty on User models."},toJSON:function(){var a=Backbone.Model.prototype.toJSON.apply(this,arguments);a.thread={};if(!this.hasValidAvatar())a.avatar=this.defaults.avatar;return a}}),m=p.extend({idAttribute:"emailHash"});a.addType("AnonUser",m);var l=p.extend({fetch:function(a){var c=this,a=a||{};DISQUS.api.call("users/details.json",{data:c.id?{user:c.id}:{},success:function(d){d=
d.response;c.set(d);a.success&&a.success(d);a.complete&&a.complete(d)},error:function(c){a.error&&a.error(c);a.complete&&a.complete(c)}})},toJSON:function(){var a=p.prototype.toJSON.call(this),c=this.collection&&this.collection.thread;a.thread.canModerate=!!c&&c.isModerator(this);return a},follow:function(){var a=this;DISQUS.api.call("users/follow.json",{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!0)}})},unfollow:function(){var a=this;DISQUS.api.call("users/unfollow.json",
{data:{target:this.id},method:"POST",success:function(){a.set("isFollowing",!1)}})}});a.addType("User",l);var q=l.extend({defaults:_.extend({numPosts:0},l.prototype.defaults)}),x=function(){var c=_.extend({id:0,user:new a(m),canReply:!0,canModerate:!1,mustVerifyEmail:!1,_eventProxy:function(){c.trigger.apply(c,arguments)},_setProxy:function(){c.user.on("all",c._eventProxy)},_clearProxy:function(){c.user.off("all",c._eventProxy)},_setUser:function(a){c._clearProxy();c.user=a;c._setProxy();c.trigger("change:id",
a)},isRegistered:function(){return c.user instanceof l},isAnonymous:function(){return c.user instanceof m},toJSON:function(){var a=c.user.toJSON.apply(c.user,arguments);a.thread.canReply=c.canReply;if(!a.thread.canModerate)a.thread.canModerate=c.canModerate;return a},fetch:function(d){var d=d||{},e={thread:d.thread.id,post:d.thread.posts.pluck("id")};e["_"+(new Date).getTime()]=1;DISQUS.api.call("embed/threadDetails.json",{data:e,success:function(e){var e=e.response,f={};e.user&&_.extend(f,e.user,
{votes:e.votes});f.id&&(_.extend(c,e.session),c._setUser(new a(l,f)),d.thread.users.add(c.user));d.success&&d.success(e);d.complete&&d.complete(e)},error:function(a){d.error&&d.error(a);d.complete&&d.complete(a)}})},register:function(d,e){DISQUS.api.call("internal/users/register.json",{secure:!0,data:{display_name:d.name,email:d.email},method:"POST",success:function(d){c._setUser(new a(l,d.response))},error:e.error||function(){}})},logout:function(){DISQUS.api.call("internal/users/logout.json",{method:"POST",
success:function(){c._setUser(new a(m))}})}},Backbone.Events);return c}(),t=Backbone.Model.extend({defaults:{score:0}}),w=Backbone.Model.extend({defaults:{score:0}}),A=Backbone.Model.extend({defaults:function(){return{object:{},type:"",createdAt:moment().format(DISQUS.ISO_8601)}},toJSON:function(){var a=Backbone.Model.prototype.toJSON.call(this),c=DISQUS.assureOffset(this.get("createdAt"));a.relativeCreatedAt=moment(c,DISQUS.ISO_8601).fromNow();return a}}),y=Backbone.Model.extend({defaults:function(){return{sender:"",
timestamp:moment().valueOf(),type:0,formatted:"",theme:""}}}),v=Backbone.Model.extend({defaults:{enabled:!1}}),B=Backbone.Model.extend({defaults:{thread:null,forum:null,body:null,service:{url:null,name:null},url:null,title:null},set:function(c,d){if(c&&typeof c!=="string"){if(c.author)this.author=new a(c.author.id?l:m,c.author),delete c.author;if(c.createdAt)c.relativeCreatedAt=moment(DISQUS.assureOffset(c.createdAt),DISQUS.ISO_8601).fromNow()}return Backbone.Model.prototype.set.call(this,c,d)},toJSON:function(){var a=
Backbone.Model.prototype.toJSON.call(this);if(this.author)a.author=this.author.toJSON();return a},destroy:function(){DISQUS.api.call("reactions/remove.json",{data:{reaction:this.id,forum:this.get("forum")},method:"POST"})}});return{UniqueModel:a,Forum:f,Thread:d,TopThread:c,Post:g,QueuedPost:o,Reaction:B,TypingUser:k,User:l,AnonUser:m,Session:x,TopUser:q,Vote:t,ThreadVote:w,Notification:y,ActivityItem:A,Switch:v}});
DISQUS.define("lounge.collections",function(){var a=DISQUS.use("lounge.models"),e=DISQUS.use("lounge.utils"),i=Backbone.Collection.extend({model:a.ThreadVote}),j=Backbone.Collection.extend({model:_.bind(a.UniqueModel,{},a.User),initialize:function(a,c){Backbone.Collection.prototype.initialize.apply(this,arguments);this.thread=c&&c.thread}}),f=Backbone.Collection.extend({model:a.Notification,url:DISQUS.api.getURL("messagesx/unread"),initialize:function(a,c){this.user=c.user},fetch:function(){Backbone.Collection.prototype.fetch.call(this,
{data:{user:"username:"+this.user.get("username")}})},markRead:function(){var a=this,c=_.pluck(a.models,"id");DISQUS.api.call("messagesx/markRead.json",{data:{messages:c},method:"POST",success:function(){a.remove(c)}})},parse:function(a){return a.response.messages}}),d=Backbone.Collection.extend({model:a.Vote}),c=Backbone.Collection.extend({initialize:function(a,c){this.cursor=c.cursor||{}},fetch:function(a){a.data=_.extend({},a.data||{},{cursor:a.cursor||""});return Backbone.Collection.prototype.fetch.call(this,
a)},more:function(a){this.cursor.hasNext?this.fetch(_.extend(a||{},{add:!0,cursor:this.cursor.next})):a.error&&a.error()},parse:function(a){this.cursor=a.cursor;return Backbone.Collection.prototype.parse.call(this,a)}}),g=c.extend({model:_.bind(a.UniqueModel,{},a.Post),url:DISQUS.api.getURL("threads/listPostsThreaded"),initialize:function(a,d){c.prototype.initialize.apply(this,arguments);this.thread=d.thread;this.order=e.cookies.read("disqus.order")||"popular"},fetch:function(a){a=a||{};this.order===
"popular"?e.cookies.erase("disqus.order"):e.cookies.create("disqus.order",this.order);a=_.extend(a,{data:{limit:g.PAGINATION_LIMIT,thread:this.thread.id,forum:this.thread.get("forum"),order:this.order}});return c.prototype.fetch.call(this,a)},add:function(a,c){_.isArray(a)||(a=[a]);for(var d=[],e=0;e<a.length;e++)this.get(a[e].id)||d.push(a[e]);Backbone.Collection.prototype.add.call(this,d,c)}},{PAGINATION_LIMIT:50}),o=Backbone.Collection.extend({model:a.QueuedPost,initialize:function(a,c){var d=
this;d.thread=c.thread;d.counters={comments:0,replies:{}};d.bind("add",function(a){var c=a.getVisibleParent(d.thread);c?(d.counters.replies[c.id]?d.counters.replies[c.id]+=1:d.counters.replies[c.id]=1,c.id==a.get("parentId")&&a.set("immedReply",!0)):d.counters.comments+=1})},comparator:function(a){return parseInt(a.get("id"),10)},isDescendant:function(a,c){var b;var d=a.get("parentId"),d=d?this.get(d):null,e={};for(_.each(c,function(a){e[a]=!0});d;){if(e[d.get("id")]===!0)return!0;b=(d=d.get("parentId"))?
this.get(d):null,d=b}return!1},drain:function(a){function c(a){var d=[];e.each(function(a){a.get("parentId")===null&&d.push(a.get("id"))});e.reset(e.filter(function(c){if(c.get("parentId")!==null&&!e.isDescendant(c,d))return c;a(c)}));e.counters.comments=0}function d(c){var f=[],g=[],g=e.filter(function(c){var d=c.getVisibleParent(e.thread);if(!d||d.get("id")!=a)return c;f.push(c)}),f=_.sortBy(f,function(a){return parseInt(a.get("id"),10)});_.each(f,function(a){c(a)});e.reset(g);e.counters.replies[a]=
0}var e=this;return(a?d:c)(function(a){e.thread.posts.add(a.toPost(e.thread))})}}),k=Backbone.Collection.extend({model:a.Switch,parse:function(a){return _.map(a,function(a,c){return{id:c,enabled:a}})},enabled:function(a){return(a=this.get(a))?a.get("enabled"):!1}}),p=Backbone.Collection.extend({models:a.TypingUser,initialize:function(){var a=this;a.gc=null;a.bind("add remove reset",function(){var c=a.count();if(c>0&&a.gc===null)a.gc=setInterval(_.bind(a.cleanup,a),6E4);else if(c<=0&&a.gc!==null)clearInterval(a.gc),
a.gc=null},a)},count:function(){var a=0;this.each(function(c){a+=c.get("typing")?1:-1});return a},cleanup:function(){var a=moment();this.reset(this.filter(function(c){return c.createdAt.diff(a,"minutes")>5}))}}),m=Backbone.Collection.extend({model:a.ActivityItem,url:DISQUS.api.getURL("users/listActivity"),initialize:function(a,c){this.user=c.user;this.include=c.include||null},fetch:function(){var a={user:"username:"+this.user.get("username")};if(this.include)a.include=this.include;Backbone.Collection.prototype.fetch.call(this,
{data:a})}}),l=Backbone.Collection.extend({model:_.bind(a.UniqueModel,{},a.Post),url:DISQUS.api.getURL("users/listPostActivity")}),q=Backbone.Collection.extend({model:a.TopThread,url:DISQUS.api.getURL("threads/listPopular"),initialize:function(a,c){this.forum=c.forum;this.limit=c.limit},add:function(a,c){_.isArray(a)||(a=[a]);var d=[];_.each(a,function(a){a.title.match(/^http/i)||d.push(a)});Backbone.Collection.prototype.add.call(this,d,c)},fetch:function(){Backbone.Collection.prototype.fetch.call(this,
{data:{forum:this.forum,limit:this.limit,interval:"7d",with_top_post:!0}})}}),x=Backbone.Collection.extend({model:a.TopUser,url:DISQUS.api.getURL("forums/listMostActiveUsers"),initialize:function(a,c){this.forum=c.forum;this.limit=c.limit;this.discardLowRep=c.discardLowRep},fetch:function(){Backbone.Collection.prototype.fetch.call(this,{data:{forum:this.forum,limit:this.limit}})},parse:function(a){if(!this.discardLowRep)return a.response;return _.filter(a.response,function(a){if(parseFloat(a.rep)>
0.7)return a})}}),t=c.extend({model:a.Reaction,url:DISQUS.api.getURL("threads/listReactions"),initialize:function(a,c){this.thread=c.thread},fetch:function(a){a=a||{};a=_.extend(a,{data:{limit:t.PAGINATION_LIMIT,thread:this.thread.id}});return c.prototype.fetch.call(this,a)}},{PAGINATION_LIMIT:20});return{UserCollection:j,PostCollection:g,ReactionsCollection:t,TypingUserCollection:p,TopUserCollection:x,TopThreadCollection:q,VoteCollection:d,ThreadVoteCollection:i,ActivityCollection:m,PostActivityCollection:l,
NotificationCollection:f,QueuedPostCollection:o,SwitchCollection:k}});
DISQUS.define("lounge.views",function(){function a(b){return(b=b&&b.match(/discovery\-(\w+)/))&&b[1]}var e=DISQUS.use("lounge.models"),i=DISQUS.use("lounge.collections"),j=DISQUS.use("lounge.utils"),f=DISQUS.use("lounge.realtime"),d=DISQUS.use("Bus"),c=DISQUS.use("JSON"),g,o=1,k={_getShortUrl:function(b){var a=this,c=this._shareUrl(),d=c,c=_.extend({url:c,source:"disqus_embed_next"},this.model.relatedIds());DISQUS.api.call("shortener/create.json",{method:"POST",data:c,timeout:5E3,success:function(b){if(b.code===
0)d=b.response.url},complete:function(){b.call(a,d)}})},_shareWaitPopup:function(b){var a=DISQUS.serialize(DISQUS.urls.loading,{img:DISQUS.urls.themeUrl+"/img/loader.gif"});return window.open(a,"_blank",b||"width=550,height=520")},extractService:function(b){b=$(b);b=b.is("[data-action^=share]")&&b||b.closest("[data-action^=share]");b=(b.attr("data-action")||":").split(":")[1];if(this.sharers[b])return b},share:function(b){this.sharers[b].call(this)},sharers:{twitter:function(){var b=this._shareWaitPopup();
this._getShortUrl(function(a){b.location=DISQUS.serialize("https://twitter.com/intent/tweet",{url:a,text:this.model.twitterText(a)})})},facebook:function(){var b=this._shareWaitPopup("width=655,height=352");this._getShortUrl(function(a){b.location=DISQUS.serialize("https://www.facebook.com/sharer.php",{u:a})})}}},p={alert:function(b,a){a?_.isString(a)&&(a={type:a}):a={};this._alert&&this._alert.dismiss();var c=this._alert=new N(_.extend({message:b},a));this.updateDom(function(){c.render().$el.prependTo($("#form")[0])});
return c}},m=Backbone.View.extend({events:{"click [data-action=auth-twitter]":"authTwitter","click [data-action=auth-facebook]":"authFacebook","click [data-action=auth-google]":"authGoogle","click [data-action=auth-disqus]":"authDisqus","click [data-action=auth-sso]":"authSSO","click [data-action=verify-email]":"verifyEmail","click [data-action=audiencesync]":"audienceSync","click [data-action=debug]":"renderDebugInfo"},STREAMING_MAX_VISIBLE:250,initialize:function(b){g=this;b=b||{};b=b.jsonData||
{};this.initialData=b.response||{};if(j.extract(b,"response.forum.id"))DISQUS.urls.moderate=j.updateURL(DISQUS.urls.moderate,{hostname:b.response.forum.id+"."});this.theme=j.extract(this.initialData,"theme.base")||{};this.session=e.Session;this.forum=new e.Forum;this.thread=new e.Thread(null,{forum:this.forum,postCursor:b.cursor,moderators:(this.initialData.thread||{}).moderators});this.posts=this.thread.posts;this.switches=new i.SwitchCollection;this.realtimePool=null;this.renderJobs=[];this.states=
{templateReady:!1,realtimeIndicatorsCreated:!1,pollingRunning:!1,ravenConfigured:!1,inViewport:!1,streamingPaused:!1};d.bind("window.inViewport",function(){this.states.inViewport=!0;this.trigger("inViewport")},this);d.bind("window.scrollOffViewport",function(){this.states.inViewport=!1},this);d.bind("switches.changed",function(b){this.switches.reset(this.switches.parse(b));if(!this.states.ravenConfigured&&this.switches.enabled("next_raven"))Raven.config({servers:["http://disqus.com/raven/api/store/"],
logger:"javascript.next"}),window.onerror=Raven.process,DISQUS.api.defaults({error:function(b){Raven.captureMessage({name:"API call failed.",message:b})}}),this.states.ravenConfigured=!0;if(!this.switches.enabled("next_lazy_embed")||this.states.inViewport)this.initializeSession();else this.on("inViewport",this.initializeSession,this)},this);this.switches.on("reset",function(){var b=function(){if(!this.states.templateReady)return!1;return this.thread&&this.thread.id};DISQUS.defer(_.bind(b,this),_.bind(this.poll,
this));DISQUS.defer(_.bind(b,this),_.bind(this.renderThreadVotes,this,this.thread))},this);d.bind("init",function(b){g.bootstrap(b)});b={};if(typeof this.initialData==="object"&&!_.isEmpty(this.initialData))b.thread={id:this.initialData.thread.id};d.sendHostMessage("ready",b)},bootstrap:function(b){var h=this;h.config=b||{};var c={};if(b.apiKey)c["X-Disqus-Publisher-API-Key"]=b.apiKey;if(b.remoteAuthS3)c["X-Disqus-Remote-Auth"]=b.remoteAuthS3;_.isEmpty(c)||DISQUS.api.defaults({headers:c});b.anchorColor&&
function(){var a=j.escapeColor(b.anchorColor);j.addStylesheetRules([[".publisher-anchor-color a",["color",a,!0]],["a.publisher-anchor-color",["color",a,!0]],[".publisher-anchor-hover a:hover",["color",a,!0]],["a.publisher-anchor-hover:hover",["color",a,!0]],[".active .publisher-nav-color:after",["background",a,!0]],[".media-preview .active.publisher-border-color",["border-color",a,!0]]])}();c=$("body");b.serif&&c.addClass("serif");(function(){var a=document.createElement("base");a.target="_parent";
a.href=b.referrer;$("head").append(a)})();if(b.referrer)h.thread.currentUrl=b.referrer;if(b.width)document.body.style.width=b.width+"px";if(b.permalink)h.on("postsRendered",_.once(function(){h.scrollToPost(b.permalink)}));if(b.sso)DISQUS.templateGlobals.sso=b.sso;var e=this.theme.js,f=this.theme.css;b.themeUrl&&(e=b.themeUrl+"/theme.js",f=b.themeUrl+"/theme.css");DISQUS.urls.themeUrl=b.themeUrl||this.theme.root;DISQUS.requireStylesheet(f,{},DISQUS.debug);DISQUS.require(e,{},DISQUS.debug,function(){h.renderLayout();
h.states.templateReady=!0;h.trigger("templateReady")});h.bind("templateReady",h.renderForm,h);h.bind("templateReady",h.updatePostCount,h);h.bind("templateReady",h.initCommunity,h);h.bind("templateReady",h.initReactions,h);h.bind("templateReady",h.initUserMenu,h);h.bind("templateReady",h.renderStreamingToggle,h);h.renderBindings([h.thread,"change:likes",h.updateThreadVotes],[h.thread,"change:userScore",h.updateThreadUserScore],[h.thread,"change:posts",h.updatePostCount],[h.thread,"change:userSubscription",
h.renderThreadVotes],[h.thread.posts,"reset",h.redrawPosts],[h.thread.posts,"add",h.addPosts],[h.thread.posts,"remove",h.removePost],[h.thread.posts,"reset add",h.toggleLoadMorePosts],[h.thread.posts,"reset add",h.toggleNoPosts],[h.thread.posts,"reset",function(){h.poll()}],[h.thread.reactions,"reset add",h.toggleLoadMoreReactions],[h.session,"change:id",h.updateThreadSessionData],[h.session,"change:id",h.initDashboard],[h.session,"change:id",h.renderThreadVotes],[h.session,"change:id",h.audienceSyncToggle]);
h.bind("scroll",function(b){h.position=b;if(h.currentSection==="conversation")h.conversationPosition=b});h.bind("scrollOffViewport",function(){h.states.realtimeIndicatorsCreated&&h.currentSection==="conversation"&&(d.sendHostMessage("realtime.hideNorth"),d.sendHostMessage("realtime.hideSouth"))});h.bind("scroll",function(b){if(h.states.realtimeIndicatorsCreated&&h.currentSection==="conversation"){var a=_.union([this.queueView],_.values(this.postViews)),c=0,e=0;_.each(a,function(a){if(a&&!a.getDirection)a=
a.queueView;if(a&&!(a.options.count<=0)){var h=a.getDirection(b);h===1?c+=a.options.count:h===-1&&(e+=a.options.count)}});var a="realtime.hideNorth",u;c>0&&(a="realtime.showNorth",u=DISQUS.renderBlock("realtimeIndicatorText",{num:c,orientation:"north"}));d.sendHostMessage(a,u);a="realtime.hideSouth";u=void 0;e>0&&(u=DISQUS.renderBlock("realtimeIndicatorText",{num:e,orientation:"south"}),a="realtime.showSouth");d.sendHostMessage(a,u)}},h);d.bind("window.hashchange",function(b){if(a(b))return void d.sendHostMessage("reset");
(b=b&&b.match(/comment\-([0-9]+)/))&&h.scrollToPost(b[1])});d.bind("window.scroll",function(b){h.trigger("scroll",b)});d.bind("window.scrollOffViewport",function(){h.trigger("scrollOffViewport")});d.bind("window.resize",h.resize,h);d.bind("realtime.click",function(b){d.sendHostMessage("realtime.hide"+(b==="north"?"North":"South"));var a=_.union([h],_.toArray(h.postViews)),c,u,a=_.filter(a,function(a){a=a.queueView;if(!a||a.options.count<=0)return!1;var c=b==="north"?1:-1;if(a.getDirection(h.position)!==
c)return!1;return!0}),a=_.sortBy(a,function(b){if(b===h)return 0;return b.offset.top}),a=b==="north"?_.last(a):_.first(a);c=a.queueView;a===h?(u=0,c.model.queue.drain(),c.setCount(c.model.queue.length)):(u=a.offset.top-100,c.options.thread.queue.drain(c.model.id),c.setCount(c.options.thread.queue.length));var e=function(){d.sendHostMessage("scrollTo",{top:u});m.getInstance().off("domReflow",e)};m.getInstance().on("domReflow",e)});h.thread.queue.bind("add reset",h.toggleRealtimeNotifications,h);h.forum.set(this.initialData.forum);
h.thread.set(this.initialData.thread);h.posts.reset(this.initialData.posts);if(h.forum.get("settings").ssoRequired)h.session.canReply=!1;h.getColorScheme()==="dark"&&c.addClass("dark");d.bind("auth:success",function(b){b&&b.sessionId&&DISQUS.api.defaults({headers:{"X-Sessionid":b.sessionId}});h.refreshSession()});d.bind("audiencesync:grant",function(){if(this._alert)this._alert.remove(),this._alert=null},this);_.delay(function F(){h.postViews&&!(_.size(h.postViews)<1)&&(_.invoke(h.postViews,"updateRelativeTime"),
_.delay(F,6E4))},6E4);h.currentSection="conversation";h.thread.on("create",function(b){d.sendHostMessage("posts.create",b.toJSON())});h.initialized=!0},initializeSession:function(){var b=this;(!b.forum.get("settings").ssoRequired||b.config.remoteAuthS3)&&b.session.fetch({thread:b.thread,complete:function(a){b.session.trigger("identify");b.session.on("authenticated",b.refreshSession,b);var c=j.extract(a,"theme.discovery");c&&b.initDiscovery(c);c=m.getInstance();j.extract(a,"session.isReadOnly")&&c.alert("The Disqus comment system is temporarily in maintenance mode. You can still read comments during this time, however posting comments and other actions are temporarily delayed.")}})},
refreshSession:function(){this.session.fetch({thread:this.thread})},initRealtime:function(){var b={width:$("html").width()+"px",position:"fixed"},a={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"north"}),styles:{top:"0"}},c={contents:DISQUS.renderBlock("realtimeIndicator",{orientation:"south"}),styles:{bottom:"0"}};_.defaults(a.styles,b);_.defaults(c.styles,b);d.sendHostMessage("realtime.init",{north:a,south:c});this.states.realtimeIndicatorsCreated=!0},insertStreamingComments:_.throttle(function(){var b=
this.thread.queue;b.drain();_.each(b.counters.replies,function(a,c){b.drain(c)})},1E3),getColorScheme:function(){var b=this.forum.get("settings"),a=this.config.colorScheme||"light";b.overrideStyles&&(a=b.darkTheme?"dark":"light");return a},toggleRealtimeNotifications:function(){var b=this,a=b.thread.queue;b.updateDom(function(){_.defer(function(){d.sendHostMessage("fakeScroll")});if(!a.length)return void $("[data-role=realtime-notification]").hide();if(b.thread.get("hasStreaming"))return void b.insertStreamingComments();
var c=b.queueView||new C({model:b.thread,el:b.$el.find("button[data-role=realtime-notification]")});b.queueView=c;c.setCount(a.counters.comments);c.render();_.each(a.counters.replies,function(a,c){var h=b.thread.posts.get(c);if(h){var d=b.postViews[h.cid],e=d.queueView;if(!e)e=new K({thread:b.thread,postView:d,model:h,el:d.$el.find("[data-role=realtime-notification:"+c+"] a")}),d.queueView=e;e.setCount(a);e.render()}})})},renderDebugInfo:function(){if(this.session.user.get("isGlobalAdmin")){var b=
new O({Shortname:this.thread.get("forum"),"Thread ID":this.thread.get("id"),"Thread slug":this.thread.get("slug"),"Anchor color":j.escapeColor(this.config.anchorColor)});b.render();this.updateDom(function(){var a=document.body;a.insertBefore(b.el,a.firstChild)})}},scrollToPost:function(b,a,c){var f=this;f.currentSection!=="conversation"&&(c=!0);f.mainNav.navTo("conversation");var g=f.$el.find("#post-"+b);g.length?(a=a||0,_.delay(function(){d.sendHostMessage("scrollTo",{top:g.offset().top+a,force:c||
null})},100)):DISQUS.api.call("posts/getContext.json",{method:"GET",data:{post:b},success:function(d){d=_.filter(d.response,function(b){return b.thread==f.thread.get("id")});d.length!==0&&(_.each(d,function(b){f.thread.posts.add(new e.UniqueModel(e.Post,b))}),f.on("domReflow",function Y(){f.off("domReflow",Y);f.scrollToPost(b,a,c)}))}})},updateThreadSessionData:function(b){b&&(b.get("thread")&&this.thread.set(b.get("thread")),(b=b.get("votes"))&&typeof b==="object"&&_.each(b,function(b,a){var c=this.posts.get(a);
c&&c.set("userScore",b)},this))},initDashboard:function(){var b=$("#main-nav [data-nav=dashboard]");if(this.session.isAnonymous())return b.hide();b.show();this.notifications=new i.NotificationCollection(null,{user:this.session.user});this.notifications.fetch();this.notificationCount=new J({el:b.find("[data-role=notification-count]")[0],collection:this.notifications});this.dashboard=new P({el:$("#dashboard")[0],user:this.session.user,notifications:this.notifications})},initCommunity:function(){this.community=
new Q({el:document.getElementById("community"),forum:this.forum})},initReactions:function(){this.reactions=new ba({el:$("#reaction-list")[0],collection:this.thread.reactions,thread:this.thread,session:this.session});this.forum.get("settings").hasReactions&&$("#global-nav").length===0&&(this.thread.reactions.on("reset",function(){$("#reactions").show()}),this.thread.reactions.fetch())},_getLogoutUrl:function(){return this.config.sso&&this.session.user.get("user_type")==="sso"?this.config.sso.logout:
DISQUS.urls.logout},initUserMenu:function(){var b=this.userMenu=new x({el:this.$el.find("[data-role=logout]")[0],session:this.session,thread:this.thread,showLogin:!this.forum.get("settings").ssoRequired,logoutUrl:this._getLogoutUrl(),referrerUrl:this.config.referrer});this.session.on("change:id",function(){b.logoutUrl=this._getLogoutUrl();b.render()},this);this.thread.on("change:isClosed",this.render,this);b.render()},initDiscovery:function(b){function c(b){if(!i){if(!e.switches.length)return void e.switches.on("reset",
function aa(){c(b);e.switches.off("reset",aa)});if(e.switches.enabled("discovery_next"))try{DISQUS.runThemeScript&&(DISQUS.runThemeScript(),i=!0),DISQUS.discovery.init(_.extend({},e.config,{variant:g,thread:e.initialData.thread,forum:e.initialData.forum,switches:e.switches}),b)}catch(a){return void Raven.captureMessage({name:"There is a bug in Discovery JS. Variant: "+g,message:a})}}}function d(b){b.on("allSubviewsRendered",e.updateDom,e);b.on("resize",e.updateDom,e);e.updateDom(function(){var a=
"#discovery";if(g=="top"||g=="top2")a+="-top";b.render();$(a).append(b.$el)})}var e=this;if(!e.states.templateReady)return void e.on("templateReady",function Z(){e.initDiscovery(b);e.off("templateReady",Z)});var f=a(e.config.parentWindowHash);f&&(b={js:b.js.replace(RegExp(b.name+"\\.js$"),f+".js"),css:b.css.replace(RegExp(b.name+"\\.css$"),f+".css"),name:f});var g,i=!1;g=b.name;DISQUS.requireStylesheet(b.css,{},DISQUS.debug);DISQUS.require(b.js,{},DISQUS.debug,function(){c(d)});e.initDiscovery=function(){}},
toggleLoadMorePosts:function(){var b=this.$el.find("#posts [data-role=more]");this.updateDom(function(){b[this.thread.posts.cursor.hasNext?"show":"hide"]()},this)},toggleLoadMoreReactions:function(){var b=this.$el.find("#reactions [data-role=more]");this.updateDom(function(){b[this.thread.reactions.cursor.hasNext?"show":"hide"]()},this)},poll:function(){function b(b){var b=b.message_body,a=g.thread;if(!g.thread.get("hasStreaming")||!g.states.streamingPaused){if(!b.id)return void DISQUS.logError("RT: no post ID");
if(!b.author||!b.author.id)return void DISQUS.logError("RT: no author or author ID");if(!b.author.name||!b.author.email_md5)return void DISQUS.logError("RT: no author name or email hash");if(!b.post||!b.post.message)return void DISQUS.logError("RT: no post message");if(a.posts.get(b.id)||a.queue.get(b.id))return void DISQUS.log("RT: duplicate",b.id);if(b.type!=="approved"||b.type_prev!==null)return void DISQUS.log("RT: unnaproved",b.id);g.thread.incrementPostCount(1);var c=b.post.parent_post.id;if((c=
c!=="0"?c:null)&&!a.posts.get(c)&&!a.queue.get(c))return void DISQUS.log("RT: parent is not on this page",b.id);var h=b.author.id,d=a.users.get(h);d||(d=new e.UniqueModel(e.User,{id:h,name:b.author.name,emailHash:b.author.email_md5,isAnonymous:b.author.id==="0"}),b.author.avatar&&d.set("avatar",{cache:b.author.avatar,pemalink:b.author.avatar}),a.users.add(d));a.queue.add({id:b.id,userId:d.get("id"),parentId:c,message:b.post.message})}}function a(b){var c=b.message_body,h=g.thread.posts.get(c.vote.recipient_post_id);
c.id&&c.vote&&!(g.session.user.id&&c.vote.voter_id==g.session.user.id)&&h&&(b=h.votes.get(c.id),b||(b=new e.Vote({id:c.id}),h.votes.add(b)),c=h._vote(c.vote.vote,b.get("score")),c!==0&&b.set("score",c))}function c(b){var a=b.message_body,h=g.thread;a.id&&a.vote&&!(g.session.user.id&&a.vote.voter_id==g.session.user.id)&&(b=h.votes.get(a.id),b||(b=new e.ThreadVote({id:a.id}),h.votes.add(b)),a=h._vote(a.vote.vote,b.get("score")),a!==0&&b.set("score",a))}function d(b){var a=b.message_body,c=g.thread;
a.thread_id==c.id&&a.post.parent_post.id&&(a=c.posts.get(a.post.parent_post.id))&&(a.usersTyping.get(b.firehose_id)||(!(a.usersTyping.count()<=0)||b.typing)&&a.usersTyping.add(new e.TypingUser({id:b.firehose_id,typing:b.typing})))}var g=this,i=g.switches.enabled("next_realtime_overlap");if(g.switches.enabled("next_realtime")&&(window.location.protocol!=="https:"||g.switches.enabled("next_disable_ssl_realtime"))){if(i){if(g.realtimePool!==null)return}else{if(g.states.pollingRunning)return;g.states.pollingRunning=
!0}g.switches.enabled("next_realtime_indicators")&&(g.states.realtimeIndicatorsCreated||g.initRealtime());var j=DISQUS.urls.realertime+"/api/2/thread/"+g.thread.id,k;i?(g.realtimePool=new f.Pool(j),g.realtimePool.on("progress",function(e){_.each(e,function(e){switch(e.message_type){case "Post":b(e);break;case "Vote":a(e);break;case "ThreadVote":c(e);break;case "IsTyping":d(e)}})}),_.defer(function(){g.realtimePool.run()})):(k=new f.Firehose(j),k.on("success",function(){g.states.pollingRunning=!1;
o=1;g.poll()}),k.on("error",function(){o<=120&&(o*=2);g.states.pollingRunning=!1;_.delay(_.bind(g.poll,g),o*1E3)}),k.on("progress",function(e){switch(e.message_type){case "Post":b(e);break;case "Vote":a(e);break;case "ThreadVote":c(e);break;case "IsTyping":d(e)}}),_.defer(function(){k.run()}))}},renderBindings:function(){var b=this;_.each(arguments,function(a){var c=a[2];a[0].bind(a[1],function(){var a=arguments;b.states.templateReady?c.apply(b,a):b.bind("templateReady",function(){c.apply(b,a)})})})},
updateDom:function(){var b=0,a=_.debounce(function(){b++;for(var a,c;this.renderJobs.length;)a=this.renderJobs.shift(),c=a[0],a=a[1],c&&c.call(a);b--;this.resize();this.trigger("domReflow")},0);return function(c,d){b===0?(this.renderJobs.push([c,d]),a.call(this)):(DISQUS.logError("updateDom nested call detected"),c.call(d))}}(),audienceSyncToggle:function(){var b;this.forum.get("settings").audienceSyncEnabled&&this.session.user.id&&!this.session.audienceSyncVerified&&(b='In order to comment, you must <a href="#" data-action="audiencesync">connect with '+
this.forum.get("name")+"</a>.",this.alert(b,{safe:!0}))},renderThreadVotes:_.debounce(function(){var b;this.threadMenu&&this.threadMenu.remove();this.threadMenu=b=new q({thread:this.thread,session:this.session});b.on("subscribe:error",_.bind(this.alert,this,"Please enter a valid e-mail to subscribe.","error"));b.on("subscribe:true",_.bind(this.alert,this,"You have subscribed to this thread.","success"));b.on("subscribe:false",_.bind(this.alert,this,"You have unsubscribed from this thread.","success"));
b.on("vote:up",_.bind(this.trigger,this,"uiAction:threadUpvote"));b.on("vote:down",_.bind(this.trigger,this,"uiAction:threadDownvote"));b.render();this.updateDom(function(){$("#thread-votes").append(b.el)})},200),renderStreamingToggle:function(){var b=this;if(b.thread.get("hasStreaming")&&DISQUS.blocks.realtimeToggleButton){var a=$(DISQUS.renderBlock("realtimeToggleButton"));$(a).bind("click",function(){b.toggleStreamingRealtime()});b.updateDom(function(){$("#realtime-toggle").empty();$("#realtime-toggle").append(a[0])})}},
toggleStreamingRealtime:function(){var b=$("#realtime-toggle a.btn");this.states.streamingPaused?(this.states.streamingPaused=!1,b.addClass("pause")):(this.states.streamingPaused=!0,b.removeClass("pause"))},updateThreadVotes:function(){$("#thread-votes [data-role=like-count]").text(this.thread.get("likes"))},updateThreadUserScore:function(){var b=this.thread.get("userScore"),a=$("#thread-votes [data-role=vote-button]");a.length?(a.removeClass("upvoted").removeClass("downvoted"),b>0?a.addClass("upvoted"):
b<0&&a.addClass("downvoted")):_.defer(_.bind(this.updateThreadUserScore,this))},updatePostCount:function(){$("#post-count").html(DISQUS.renderBlock("postCount",{count:this.thread.get("posts")}))},swapMain:function(b){var a=this,c=this.$el.find("#main-nav [data-nav=conversation]").parent("li");b!=="conversation"?c.attr("data-dropdown","disabled"):c.attr("data-dropdown","enabled");a.updateDom(function(){a.states.realtimeIndicatorsCreated&&b!="conversation"&&(d.sendHostMessage("realtime.hideNorth"),
d.sendHostMessage("realtime.hideSouth"));var c=a[b];c&&!c.isRendered&&(a.freeze(!0),c.on("render:all",_.once(function(){a.freeze(!1)})),c.show());a.$el.find("[data-role=main]").hide();a.$el.find("[data-role=main]#"+b).show();a.prevSection=a.currentSection;a.currentSection=b});a.trigger("uiAction:navigate",b)},returnToConversation:function(){this.mainNav.navTo("conversation");var b=this.conversationPosition,a=b&&b.pageOffset;a&&this.updateDom(function(){_.delay(function(){d.sendHostMessage("scrollTo",
{top:a,relative:"window",force:!0})},100)},this)},setupNavigation:function(){var b=this;b.globalNav=new R({el:b.$el.find("#global-nav")[0]});b.mainNav=new R({el:b.$el.find("#main-nav")[0]});b.globalNav.on("nav",function(a){b.updateDom(function(){var c=b.$el.find("#form"),d=b.$el.find("#main-nav");switch(a){case "conversation":c.show();d.show();b.swapMain(b.prevSection||a);break;case "reactions":c.hide(),d.hide(),b.swapMain(a)}})});b.mainNav.on("nav",function(a){b.updateDom(function(){b.swapMain(a)})})},
renderLayout:function(){function b(b){return function(c){c.preventDefault();var e=$(c.currentTarget);e.addClass("busy");a.thread[b].more({success:function(){e.removeClass("busy")},error:function(){e.removeClass("busy")}});d.sendHostMessage([b,".paginate"].join(""))}}var a=this;a.setElement($(DISQUS.renderBlock("layout",{thread:_.extend(a.thread.toJSON(),{showReactions:a.forum.get("settings").hasReactions}),order:a.thread.posts.order,showFooter:!0})).appendTo("body"));var c=a.$el;a.delegateActions(a.$el,
{profile:function(b){b=$(b.currentTarget).attr("data-user");(b=a.thread.users.get(b))&&a.showProfile(b)},logout:function(){a.session.logout()},sort:function(b){var a=$(b.currentTarget),b=a.closest("li"),a=a.attr("data-sort");b.siblings().removeClass("selected");b.addClass("selected");this.thread.posts.order=a;this.thread.posts.fetch();$("#conversation-menu").removeClass("open");$("#posts [data-role=more]").hide();$("#post-list").addClass("loading").empty()},"close-thread":function(){a.thread.close({success:_.bind(d.sendHostMessage,
d,"reset"),error:_.bind(a.alert,a,"An error occurred while closing thread. Please try again.","error")})},"open-thread":function(){a.thread.open({success:_.bind(d.sendHostMessage,d,"reset"),error:_.bind(a.alert,a,"An error occurred while opening thread. Please try again.","error")})}});a.setupNavigation();_.each(["posts","reactions"],function(a){c.delegate("[data-action=more-"+a+"]","click",b(a))});a.resize();d.sendHostMessage("mainViewRendered");var e=j.extract(a,"initialData.theme.discovery");e&&
a.initDiscovery(e)},renderForm:function(){if(this.thread.get("isClosed"))return void this.alert("Comments for this thread are now closed.");if(!this.session.canReply)return void this.session.on("change:id",function u(){this.session.off("change:id",u);this.renderForm()},this);var b=new v({thread:this.thread,session:this.session});b.render();this.updateDom(function(){$("#form").prepend(b.el);b.resize()},this);this.resize()},toggleNoPosts:function(){this.updateDom(function(){var b=this.thread.posts.models;
$("#no-posts")[b.length?"hide":"show"]();$("#post-list").removeClass("loading")},this)},redrawPosts:function(){var b=this;b.postViews={};b.addPosts(b.thread.posts,{clearDom:!0});_.each(v.open,function(a,c){var d=b.postViews[c];d&&(d.toggleReply(),d.reply.textarea.set(a.textarea.get()))})},addPosts:function(b,a,c){var d=this,f=[];if(b instanceof i.PostCollection)f=b.models,c=a||{};else if(b instanceof e.Post)f=[b],c=c||{};else throw"Not a post: "+typeof b;if(f.length){var g=[];_.each(f,function(b){var a,
h=b.get("parent");h&&(a=(h=d.thread.posts.get(h))&&d.postViews[h.cid]);a=new r({parent:a,model:b,thread:d.thread,session:d.session,created:c.created});d.postViews[b.cid]=a;a.render();b.get("isRealtime")&&d.removeOldPosts.call(d);h?d.postViews[h.cid].attachChild(a):g.push(a.el)});g.length&&d.updateDom(function(){var b=$("#post-list");c.clearDom&&b.empty();$("#post-list").removeClass("loading");c.created||!f[0].id||f[0].get("isRealtime")?b.prepend(g):b.append(g);d.trigger("postsRendered")})}},showProfile:function(b){this.profile&&
this.profile.remove();var a=this.profile=new G({user:b,session:this.session});this.freeze(!0);this.updateDom(function(){this.mainNav.clear();$("#profile").empty().append(a.el);this.swapMain("profile");a.show()},this);a.bind("close",function(){this.returnToConversation();this.updateDom(function(){a.remove()},this)},this);a.bind("render:all",_.once(function(){this.freeze(!1)}),this);d.sendHostMessage("scrollTo",{top:0})},removePost:function(b){var a=this.postViews[b.cid];a&&(a.remove(),delete this.postViews[b.cid])},
removeOldPosts:_.debounce(function(){if(this.switches&&this.switches.enabled("next_realtime_cap")){var b=_.size(this.postViews)-this.STREAMING_MAX_VISIBLE;if(!(b<=0))for(var a=this.thread.posts.sortBy(function(b){return moment(b.get("createdAt")).valueOf()}),c,d=0,e=0;d<a.length&&e<=b;d++)if((c=this.postViews[a[d].cid])&&c.childrenNode.children().length===0)this.thread.posts.remove(a[d]),e+=1}},500),resize:function(){var b=$("body").height();if(!this._frozen||!(this._lastHeight&&this._lastHeight>
b))this._lastHeight=b,d.sendHostMessage("resize",{height:b})},freeze:function(b){this._frozen=!!b;this._frozen===!1&&this.resize()},getPostView:function(b){return this.postViews[b]},authTwitter:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.twitter,"_blank","width=650,height=440")},authFacebook:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.facebook,"_blank","width=550,height=300")},authGoogle:function(b){b&&b.preventDefault();window.open(DISQUS.urls.oauth.google,
"_blank","width=650,height=440")},authDisqus:function(b){b&&b.preventDefault();window.open(DISQUS.urls.login,"_blank","width=460,height=355")},authSSO:function(b){b&&b.preventDefault();if(b=m.getInstance()){var a=parseInt(b.config.sso.width||"800",10),c=parseInt(b.config.sso.height||"500",10),e=window.open(b.config.sso.url,"_blank","width="+a+",height="+c);(function X(){j.isWindowClosed(e)?d.sendHostMessage("reload"):_.delay(X,500)})()}},verifyEmail:function(b){b&&b.preventDefault();b=DISQUS.serialize(DISQUS.urls.verifyEmail,
{f:this.forum.id});window.open(b,"_blank","width=460,height=355")},audienceSync:function(b){b&&b.preventDefault();b=DISQUS.serialize(DISQUS.urls.authorize,{client_id:this.config.apiKey,scope:"read",response_type:"token",audiencesync:"1"});window.open(b,"_blank","width=460,height=355")}});m.getInstance=function(){return g};_.extend(m.prototype,k);_.extend(m.prototype,p);var l=Backbone.View.extend({updateDom:function(b,a){var c=m.getInstance();c&&c.initialized?c.updateDom(b,a):_.isFunction(b)&&b.call(a)},
resize:function(){var b=m.getInstance();b&&b.initialized&&b.resize()}}),q=l.extend({initialize:function(b){_.extend(this,b);this.model=b.thread},events:{"click [data-action=upvote]":"upvote","click [data-action=downvote]":"downvote","click [data-action=share:twitter]":"_onShare","click [data-action=share:facebook]":"_onShare","click [data-action=subscribe]":"subscribe","click [data-action=unsubscribe]":"unsubscribe","keydown #thread-subscribe-email":"subscribeKeypress","click #thread-subscribe-email":function(b){return b.stop()}},
_onShare:function(b){if(b=this.extractService(b.target))g.trigger("uiAction:threadShare",b),this.share(b)},render:function(){this.setElement($(DISQUS.renderBlock("threadVotes",{thread:this.thread.toJSON(),user:this.session.toJSON(),sharing:!0})))},subscribeKeypress:function(b){if(!(b.key!=="Enter"&&b.keyCode!==13))b=b.target.value,j.validateEmail(b)?(this.$el.find(".dropdown").removeClass("open"),this.subscribe(!0,b)):this.trigger("subscribe:error","email")},upvote:function(){this.vote(1)},downvote:function(){this.vote(-1)},
vote:function(b){var a=this;a.trigger(b===1?"vote:up":"vote:down");var c=a.thread.get("userScore")===b;c||this.updateDom(function(){a.$el.find(".dropdown").addClass("open")});a.thread.vote(c?0:b)},subscribe:function(b,a){this.thread.subscribe(!0,a);this.trigger("subscribe:true")},unsubscribe:function(){this.thread.subscribe(!1);this.trigger("subscribe:false")},_shareUrl:function(){return this.thread.url()},remove:function(){this.off();Backbone.View.prototype.remove.call(this)}});_.extend(q.prototype,
k);var x=l.extend({initialize:function(b){_.extend(this,b)},render:function(){var b=DISQUS.renderBlock("userMenu",{user:this.session.toJSON(),thread:this.thread.toJSON(),logoutUrl:this.logoutUrl,showLogin:this.showLogin,feedbackUrl:this.getSurveyMonkeyUrl()});this.updateDom(function(){this.$el.html(b)},this)},getSurveyMonkeyUrl:function(){var b=this.referrerUrl,a=this.session.user.id;return"https://www.surveymonkey.com/s/5RBPTTZ?c="+encodeURIComponent((a?[a,b]:[b]).join(";"))}}),t=new QueuedStorage(Modernizr.localstorage?
window.localStorage:DISQUS.lounge.utils.hashStorage,5,"drafts.queue"),w=function(b){if(!b)throw Error("Cannot instantinate MediaStore without a valid storageKey!");this._storageKey=b;this._store=Modernizr.localstorage?window.localStorage:DISQUS.lounge.utils.hashStorage};_.extend(w.prototype,{getItems:function(){var b=this._store.getItem(this._storageKey);return b&&c.parse(b)||{}},clear:function(){this._store.removeItem(this._storageKey)},getItem:function(b){return this.getItems()[b]},setItem:function(b,
a){var d=this.getItems();d[b]=a;this._store.setItem(this._storageKey,c.stringify(d));return a},removeItem:function(b){var a=this.getItems();if(b in a)return delete a[b],this._store.setItem(this._storageKey,c.stringify(a)),!0;return!1}});var A=l.extend({events:function(){var b={"click [data-action=attach]":"_attachMedia"};window.FormData&&_.extend(b,{dragover:"_dragOn",dragenter:"_dragOn",dragleave:"_dragOff",dragexit:"_dragOff",drop:"_drop"});return b},initialize:function(b){this.owner=b.owner;this.parent=
b.parent;this.url=b.url},setElement:function(){var b=l.prototype.setElement.apply(this,arguments);this.$dragPlaceholder=this.$el.find("[data-role=drag-drop-placeholder]");this.$mediaSelector&&this.$mediaSelector.off();this.$mediaSelector=this.$el.find("input[type=file][data-role=media-upload]");this.$mediaSelector.on("change",_.bind(this._selectorChange,this));return b},_toggleDragPlaceholder:_.throttle(function(b){b?this.$dragPlaceholder.show():this.$dragPlaceholder.hide()},50),_selectorChange:function(b){this.uploadMedia(b.target.files);
if(g.switches.enabled("next_dragdrop_nag")&&b.target.files&&Modernizr.localstorage&&!window.localStorage.getItem("usedDragDrop"))this.owner.alert("Did you know you can drag and drop images too? Try it now: drag images below.").on("dismiss",function(){window.localStorage.setItem("usedDragDrop","1")})},_dragOn:function(b){b.stop();this._toggleDragPlaceholder(!0);this.owner.owner.$el.addClass("expanded")},_dragOff:function(b){b.stop();this._toggleDragPlaceholder(!1)},_drop:function(b){b.stop();window.localStorage.setItem("usedDragDrop",
"1");this._toggleDragPlaceholder(!1);this.uploadMedia(b.dataTransfer.files)},_attachMedia:function(b){b.stop();this.$mediaSelector[0].click()},_uploadMediaModern:function(b){for(var a=this,d=new FormData,e=0,f=b[e];f;f=b[++e])f.type.match(/^image\//)&&d.append("attachment",f);d.append("json","true");this.parent&&d.append("id",this.parent.id);var g=j.makeCORSRequest("POST",this.url,function(){if(!(g.readyState!==void 0&&(g.readyState!==4||g.status!==200))){var b=c.parse(g.responseText);b.success?a.owner.addMedia(b.media):
a.owner.alert(b.message,"error")}});g.withCredentials=!0;g.send(d)},_uploadMediaLegacy:function(){var b=this,a=document.createElement("iframe"),d=document.createElement("form"),e=this.$mediaSelector[0];$(e).off();var f=$(e.cloneNode(!0));e.parentNode.replaceChild(f[0],e);f.on("change",_.bind(this._selectorChange,this));this.$mediaSelector=f;a.style.display="none";a.name="uploadFrame"+ +new Date;d.style.display="none";d.target=a.name;d.action=this.url;d.method="post";d.appendChild(a);d.appendChild(e);
if(this.parent)a=document.createElement("input"),a.type="hidden",a.name="id",a.value=this.parent.id,d.appendChild(a);d.enctype="multipart/form-data";d.encoding="multipart/form-data";var g=function(a){a=c.parse(a.data);a.name==="upload"&&($(d).remove(),$(window).off("message",g),a.data.success?b.owner.addMedia(a.data.media):b.owner.alert(a.data.message,"error"))};$(window).on("message",g);this.updateDom(function(){this.$el.append(d);d.submit()},this)},uploadMedia:function(b){this.uploadMedia=this["_uploadMedia"+
(window.FormData?"Modern":"Legacy")];return this.uploadMedia(b)}}),y=l.extend({events:{"click [data-action=detach]":"_detachMedia","click ul[data-role=media-preview-list] [data-action=preview]":"_preview"},initialize:function(b){this.alert=_.bind(b.owner.alert,b.owner);this.owner=b.owner;this.parent=b.parent;this.urls=b.urls;this.uploader=new A({owner:this,parent:this.parent,url:this.urls.add})},setElement:function(){var b=l.prototype.setElement.apply(this,arguments);this.$list=this.$el.find("ul[data-role=media-preview-list]");
this.$expandedArea=this.$el.find("[data-role=media-preview-expanded]");this.expandedImg=this.$el.find("img[data-role=media-preview-expanded-image]")[0];return b},clear:function(){this.$el.addClass("empty");this.$list.empty();this._hidePreview();this.owner.mediaStore&&this.owner.mediaStore.clear()},_$oldPreview:null,_preview:function(b){b.stop();var a=this.$expandedArea,c=this.expandedImg,d=b.currentTarget.href,e=$(b.currentTarget).closest("li");c.src!==d?this.updateDom(function(){c.src=d;a.removeClass("empty");
e.addClass("active");this._$oldPreview&&this._$oldPreview.removeClass("active");this._$oldPreview=e},this):this._hidePreview()},_hidePreview:function(){this.updateDom(function(){this.$expandedArea.addClass("empty");if(this._$oldPreview)this._$oldPreview.removeClass("active"),this._$oldPreview=null;this.expandedImg.src=null},this)},_detachMedia:function(b){b.stop();this.updateDom(function(){this.removeMedia($(b.target).closest("li"))},this)},addMedia:function(b){var a=$(DISQUS.renderBlock("mediaUpload",
{media:b}));this.owner.mediaStore.setItem(b.location,b);a.attr("data-media-id",b.location);this.updateDom(function(){this.$list.append(a);this.$el.removeClass("empty")},this)},removeMedia:function(b){var a=this.owner.mediaStore.getItem(b.attr("data-media-id")),d=this._$oldPreview;if(a){d&&b[0]===d[0]&&this._hidePreview();d={media:c.stringify(a)};if(this.parent)d.id=this.parent.id;(new Image).src=DISQUS.serialize(this.urls.remove,d,!0);this.owner.mediaStore.removeItem(a.location);this.updateDom(function(){b.remove();
this.$list.children().length||this.$el.addClass("empty")},this)}}}),v=l.extend({events:{"click [data-nav]":"showAuthSection","click [name=author-register]":"expandRegister"},initialize:function(b){this.session=b.session;this.parent=b.parent;this.thread=b.thread;this.parentView=b.parentView;this.thread.bind("change:id",function(){this.restoreDraft();if(this.thread.forum.get("settings").allowMedia)this.mediaStore=new w(this.storageKey("media"))},this);this.session.on("change:id",this.redraw,this);this.parent&&
(v.open[this.parent.cid]=this);this.textarea=Modernizr.contenteditable&&!DISQUS.browser.mobile&&(!window.opera||!window.opera.version)?new z({thread:this.thread}):new D;if(this.thread.forum.get("settings").allowMedia){if(b=this.storageKey("media"))this.mediaStore=new w(b);this.mediaUploads=new y({owner:this,parent:this.parent,urls:{add:this.thread.get("uploadAdd"),remove:this.thread.get("uploadRemove")}})}},storageKey:function(b){if(!this.thread.id)return null;return[b||"drafts","thread",this.thread.id,
"parent",this.parent?this.parent.id:0].join(":")},saveDraft:function(){this.storageKey()!==null&&t.setItem(this.storageKey(),c.stringify([this.textarea.get(),(new Date).getTime()]))},getDraft:function(){if(this.storageKey()===null)return null;var b=t.getItem(this.storageKey());if(!b)return null;b=c.parse(b);if(b[1]+86400>(new Date).getTime())return b[0];t.removeItem(this.storageKey());return null},restoreDraft:function(){this.textarea.set(this.getDraft())},updateAvatar:function(){this.$el.find("[data-role=user-avatar]").attr("src",
this.session.user.get("avatar").cache)},expandGuestForm:function(){this.$el.find("[data-role=guest-details]").addClass("expanded")},expandRegister:function(){this.$el.toggleClass("register")},redraw:function(){var b=this.$el.hasClass("expanded"),a=this.el,c=this.$el.find("textarea").val();this.render();this.$el.find("textarea").val(c);b&&this.$el.addClass("expanded");$(a).parent().length!==0&&this.updateDom(function(){a.parentNode.replaceChild(this.el,a)},this)},render:function(){var b=this,a=b.getDraft()||
"";this.setElement($(DISQUS.renderBlock("form",{message:a,parent:b.parent?b.parent.toJSON():null,user:b.session.toJSON(),mediaList:this.mediaStore?_.values(this.mediaStore.getItems()):[],allowAnonPost:b.thread.forum.get("settings").allowAnonPost,allowMedia:b.thread.forum.get("settings").allowMedia})));this.$el.find("form").bind("submit",_.bind(this.submitForm,this));a=this.textarea;a.setElement(b.$el.find("textarea")[0]);a.render();a.bind("keychange",_.debounce(this.saveDraft,500),this);a.$el.bind("focus",
function(){b.$el.addClass("expanded focus");_.delay(_.bind(b.resize,b),200)});a.$el.bind("blur",function(){b.$el.removeClass("focus")});this.mediaUploads&&(this.mediaUploads.setElement(this.$el.find("[data-role=media-preview]")[0]),this.mediaUploads.uploader.setElement(this.$el.find("[data-role=textarea]")[0]));b.$el.find("input[name=author-name]").bind("focus",function(){b.expandGuestForm()});b.typingStart();b.session.mustVerifyEmail&&b._alertMustVerify()},resize:function(){this.textarea.resize()},
showAuthSection:function(b){b&&b.preventDefault&&b.preventDefault();var a=b.currentTarget.getAttribute("data-nav");this.updateDom(function(){var b=this.$el.find("[data-nav]");_.each(b,function(b){$(b.parentNode).removeClass("active")});this.$el.find("[data-nav="+a+"]").parents("*").addClass("active");this.$el.find("section").hide();this.$el.find("[data-tab="+a+"]").show()},this)},focus:function(){this.textarea.focus()},clear:function(){var b=this;b.textarea.clear();b.$el.removeClass("expanded");b.mediaUploads&&
b.mediaUploads.clear();_.delay(function(){b.resize()},200);b.parent?b.$el.hide():b.$el.removeClass("expanded");this.storageKey()&&t.removeItem(this.storageKey())},restore:function(b){var a=this;a.textarea.set(b.get("raw_message"));_.delay(function(){a.resize()},200);a.parent&&a.$el.show()},_alertMustVerify:function(b){this.alert([this.thread.forum.get("name"),'requires you to <a href="#" data-action="verify-email">verify your email address</a> before posting'].join(" "),{safe:!0,type:b?"error":"warn"})},
submitForm:function(b){var a=this;b&&b.preventDefault&&b.preventDefault();if(this._alert)this._alert.remove(),this._alert=null;b=a.$el.find("input[name=author-register]");b=b.length&&b[0].checked;if(a.session.isAnonymous()&&b)return a.session.register({name:a.$el.find("input[name=author-name]").val(),email:a.$el.find("input[name=author-email]").val()},{error:function(){a.alert("That email address is already registered with a Disqus account. Log in or enter another email.","alert")}}),null;return a.createPost()},
createPost:function(){var b=this,a={thread:b.thread.id,depth:b.parent?b.parent.get("depth")+1:0,parent:b.parent?b.parent.id:null,raw_message:b.textarea.get()};b.session.isRegistered()?a.author_id=b.session.user.id:_.extend(a,{author_name:b.$el.find("input[name=author-name]").val(),author_email:b.$el.find("input[name=author-email]").val()});var c=new DISQUS.lounge.models.UniqueModel(DISQUS.lounge.models.Post);if(c.set(a,{error:function(a,c){b.alert(c,"error")}})){var d=null,f=function(a,h){if(h.code===
19){if(d)return d.reload();d=new n;d.render();var e=g.getPostView(c.cid);e.el.parentNode.insertBefore(d.el,e.el);d.start();d.bind("submitted",function(){c.save({recaptcha_challenge_field:d.getChallenge(),recaptcha_response_field:d.getResponse()},{success:function(){d.remove()}})})}else h.code===12&&/verify/.test(h.response)?b._alertMustVerify(!0):_.isString(h.response)&&b.alert(h.response,"error"),b.thread.posts.remove(c),b.restore(c),b.thread.incrementPostCount(-1)};c.on("error",f);c.on("sync",function F(){b.thread.trigger("create",
c);c.off("error",f);c.off("sync",F)});c.save(a);c.author=b.session.isRegistered()?b.session.user:new e.UniqueModel(e.User,{id:md5(a.author_email),name:a.author_name,email:a.author_email});b.thread.posts.add(c,{created:!0});b.clear();b.trigger("submitted");b.thread.incrementPostCount(1);g.trigger("uiAction:createPost",c);return c}},remove:function(){this.updateDom(function(){this.$el.remove()},this);this.parent&&(delete v.open[this.parent.cid],this.typingStop())},toggle:function(){this.$el.toggle();
this.isOpen()?this.typingStart():this.typingStop()},isOpen:function(){return this.el.style.display!=="none"},typingStart:function(){var b=this;if(b.parent){var a=m.getInstance();a.switches&&a.switches.enabled("next_realtime")&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",d;j.attempt(function(){d=j.makeCORSRequest("POST",a)});if(d===null)return void DISQUS.log("CORS is not supported by this browser.");var h=c.stringify({typing:!0,forum_url:b.thread.get("forum"),thread_id:b.thread.get("id"),
user_id:b.session.user.id||0,parent_post_id:b.parent.get("id")});j.attempt(function(){d.send(h)})},500)}},typingStop:function(){var b=this;if(b.parent){var a=m.getInstance();a.switches&&a.switches.enabled("next_realtime")&&_.delay(function(){var a=DISQUS.urls.realertime+"/api/2/typing/",d;j.attempt(function(){d=j.makeCORSRequest("POST",a)});if(d===null)return void DISQUS.log("CORS is not supported by this browser.");var h=c.stringify({typing:!1,forum_url:b.thread.get("forum"),thread_id:b.thread.get("id"),
user_id:b.session.user.id||0,parent_post_id:b.parent.get("id")});j.attempt(function(){d.send(h)})},500)}}});_.extend(v.prototype,p);v.open=v.open||{};var B=l.extend({initialize:function(b){this.post=b.post;this.textarea=new D},render:function(){this.setElement($(DISQUS.renderBlock("edit",{post:this.post.toJSON()})));this.$el.find("form").bind("submit",_.bind(this.submitForm,this));var b=this.textarea;b.setElement(this.$el.find("textarea")[0]);b.render()},resize:function(){this.textarea.resize()},
submitForm:function(b){b&&b.preventDefault()&&b.preventDefault();var b={raw_message:this.textarea.get()},a=this.post.validate(b);if(a!==void 0)return alert(a);this.trigger("submitted");this.post.save(b,{success:function(){}})},remove:function(){this.updateDom(function(){this.$el.remove()},this)}}),r=l.extend({MAX_INDENT_DEPTH:3,initialize:function(b){this.thread=b.thread;this.session=b.session;this.created=!!b.created;this.model.bind("destroy",this.removeAsDeleted,this);this.model.bind("spam",this.removeAsDeleted,
this);this.model.bind("change:message",this.stopLoading,this);this.model.bind("change:points",this.updatePoints,this);this.model.bind("change:userScore",this.updateVotes,this);this.model.usersTyping.bind("add remove reset",this.updateTypingCount,this);this.session.on("change:id",this.updateEditHide,this);this.session.on("change:id",this.updateFooter,this);this.session.on("change:id",this.updateMenu,this);this.model.bind("change",function(){var b=this.model.changedAttributes();(b.id||b.message)&&this.redraw()},
this);this.edit=this.reply=null;this.parent=b.parent;this.trackPosition=!1;m.getInstance().on("domReflow",function(){if(this.trackPosition){var b=this.contentNode;this.offset=b.offset();this.dim=b.dim()}else this.offset={top:-1,height:-1},this.dim={height:-1,width:-1}},this)},updateTypingCount:function(){this.typingUserView&&this.typingUserView.render()},stopLoading:function(){this.contentNode.find(".loading").removeClass("loading")},updateRelativeTime:function(){this.contentNode.find("[data-role=relative-time]").text(this.model.getRelativeCreatedAt())},
updateVotes:function(b){var a=this.contentNode.find("[data-role=voting]"),c=DISQUS.renderBlock("postVotes",{post:{userScore:b.get("userScore"),points:b.get("points"),likes:b.get("likes"),dislikes:b.get("dislikes")}});this.updateDom(function(){a.html(c)})},updateEditHide:function(){var b=this.contentNode.find("[data-role=edit-hide]"),a=DISQUS.renderBlock("postEditHide",{post:{author:{id:this.model.author.id}},session:{id:this.session.user.id}});this.updateDom(function(){b.html(a)})},updateFooter:function(){var b=
this.contentNode.find("footer"),a=DISQUS.renderBlock("postFooter",{post:this.model.toJSON(),session:this.session.toJSON(),thread:this.thread.toJSON()});this.updateDom(function(){b.html(a)})},updateMenu:function(){var b=this.contentNode.find("[data-role=menu]"),a=DISQUS.renderBlock("postMenu",{session:this.session.toJSON(),post:this.model.toJSON()});this.updateDom(function(){b.html(a)})},updatePoints:function(b){var a=function(b){_.delay(function(){b.addClass("update");_.delay(function(){b.removeClass("update")},
1E3)},500)};this.contentNode.find("[data-role=points], [data-role=likes], [data-role=dislikes]").each(function(c){var c=$(c),d=c.html(),e=b.get(c.attr("data-role")).toString();d!==e&&(c.removeClass("count-"+e),c.removeClass("count-"+d),c.html(e),a(c))})},markSeen:function(){function b(d){var e,f;if(!d)return!1;e=a.offset.top+d.frameOffset.top;f=(f=e>d.pageOffset)&&e+a.dim.height<=d.pageOffset+d.height;if(!f)return!1;a.contentNode.addClass("seen");_.delay(function(){a.contentNode.removeClass("seen");
a.contentNode.removeClass("new")},1E4);a.trackPosition=!1;c.off("scroll",b);return!0}var a=this,c=m.getInstance();if(!b(c.position))c.on("scroll",b,a);c.off("domReflow",a.markSeen)},mentionParent:function(){if(this.model.id&&this.model.get("message")&&!(this.model.get("depth")<=this.MAX_INDENT_DEPTH)&&this.contentNode){var b=this.contentNode.find("[data-role=message]"),a=b.children().first();a.length||(a=b);if(b=this.thread.posts.get(this.model.get("parent"))){var c=b.author.get("name")||b.author.get("username"),
d=this.model.messageText().indexOf(c);d>-1&&d<25||$(DISQUS.renderBlock("mention",{url:b.author.get("profileUrl"),name:c})).prependTo(a)}}},render:function(){var b=this;b.setElement($(DISQUS.renderBlock("post",{post:b.model.toJSON(),session:b.session.toJSON(),thread:b.thread.toJSON(),loading:!b.model.id,created:b.created})));b.contentNode=b.$el.find("[data-role=post-content]");b.childrenNode=b.$el.find("[data-role=children]");this.highlightSyntax();b.model.get("depth")>b.MAX_INDENT_DEPTH&&b.mentionParent();
if(b.model.get("isRealtime"))m.getInstance().switches.enabled("next_realtime_anim_disabled")?b.contentNode.removeClass("new"):(b.trackPosition=!0,g.on("domReflow",b.markSeen,b));g.on("domReflow",_.once(function(){var a=b.$el.find("[data-role=realtime-notification:"+b.model.id+"] .realtime-replies");b.typingUserView=new M({parentView:b,model:b.model,el:a})}));b.processMentions();b.bindDomEvents();var a=b.parent&&b.parent.model;if(a&&!a.get("isDeleted"))b.contextCard=H.create({post:this.parent.model,
targetElement:this.$el.find("[data-role=parent-link]")})},highlightSyntax:function(){var b=this.contentNode.find("pre code");b.length&&b.each(function(b){j.syntaxHighlighter.highlight(b)})},redraw:function(){var b=this.$el;if(!b)throw Error("Old child not found on PostView.redraw");var a=this.childrenNode.children();this.render();this.updateDom(function(){b[0].parentNode.replaceChild(this.el,b[0]);this.childrenNode.append(a)},this)},processMentions:function(){this.contentNode.find("[data-dsq-mention]").each(function(){$(this).addClass("mention")})},
attachChild:function(b){var a=b.model;!a.id||a.get("isImmediateReply")?this.childrenNode.prepend(b.el):this.childrenNode.append(b.el)},toggleReply:function(){if(this.reply)return void this.reply.toggle();this.reply=new v({parentView:this,parent:this.model,thread:this.thread,session:this.options.session});this.reply.bind("submitted",function(){this.reply.$el.hide()},this);this.drawReply()},drawReply:function(){this.reply&&(this.reply.render(),this.updateDom(function(){var b=this.childrenNode[0];b.insertBefore(this.reply.el,
b.firstChild);this.reply.focus()},this))},toggleEdit:function(){this.edit?(this.edit.remove(),this.edit=null,this.contentNode.find("[data-role=message]").show()):(this.edit=new B({post:this.model}),this.edit.render(),this.edit.bind("submitted",this.toggleEdit,this),this.updateDom(function(){var b=this.contentNode.find("[data-role=message]");b[0].parentNode.insertBefore(this.edit.el,b[0]);b.hide();this.edit.resize();(b=m.getInstance())&&b.scrollToPost(this.model.id)},this))},removeAsDeleted:function(){this.redraw()},
bindDomEvents:function(){var b=this;b.delegateActions(b.contentNode,{upvote:function(){b.handleVote(1)},downvote:function(){b.handleVote(-1)},reply:"handleReply",flag:"handleFlag",edit:"handleEdit","delete":"handleDelete",spam:"handleSpam",blacklist:"handleBlacklist",collapse:"handleCollapse",reveal:"handleReveal","share:twitter":"_onShare","share:facebook":"_onShare"});var a=b.$el.find(".hovercard");if(a.length)b.profileCard=E.create({session:b.session,user:b.model.author,targetElement:a})},_onShare:function(b){if(b=
this.extractService(b.target))g.trigger("uiAction:postShare",b),this.share(b)},_shareUrl:function(){return this.thread.url()+"#comment-"+this.model.id},handleBlacklist:function(){if(!this.blacklist){var b=this.blacklist=new S({model:this.model});b.render();b.on("success cancel",function(){this.blacklist.remove();this.blacklist=null},this);this.updateDom(function(){this.contentNode.find("[data-role=blacklist-form]").first().append(b.el)},this)}},handleCollapse:function(){this.updateDom(function(){this.$el.toggleClass("collapsed")},
this)},handleVote:function(b){b===1?g.trigger("uiAction:postUpvote"):b===-1&&g.trigger("uiAction:postDownvote");var a=this.model.get("userScore")===b;this.model.vote(a?0:b);var c=this.contentNode.find("[data-role=voting]");c.removeClass("upvoted").removeClass("downvoted");a||(b>0?c.addClass("upvoted"):b<0&&c.addClass("downvoted"))},remove:function(){this.model.off(null,null,this);this.session.off(null,null,this);Backbone.View.prototype.remove.call(this)},handleReply:function(){this.toggleReply()},
handleFlag:function(){window.confirm("Are you sure you want to flag this comment?")&&this.model.report()},handleEdit:function(){this.toggleEdit()},handleDelete:function(){this.model.destroy()},handleSpam:function(){this.model.spam()},handleReveal:function(){this.model.set("isMinimized",!1);this.redraw()}});_.extend(r.prototype,k);var n=l.extend({render:function(){var b=this;b.setElement($(DISQUS.renderBlock("captcha")));b.$el.bind("submit",function(a){a.preventDefault();b.trigger("submitted")})},
start:function(){function b(){a.updateDom(function(){Recaptcha.create("6LdKMrwSAAAAAPPLVhQE9LPRW4LUSZb810_iaa8u",a.el,{theme:"custom",custom_theme_widget:"recaptcha_widget"});a.$el.show()})}var a=this;typeof Recaptcha==="undefined"?DISQUS.require("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",{},!1,b):b()},getChallenge:function(){return Recaptcha.get_challenge()},getResponse:function(){return Recaptcha.get_response()},reload:function(){Recaptcha.reload()}}),J=l.extend({initialize:function(){this.collection.bind("add reset remove",
this.render,this);this.render()},render:function(){this.$el.text(this.collection.length);this.collection.length>0?this.$el.show():this.$el.hide();return this}}),C=Backbone.View.extend({__type__:"QueuedPostView",getDirection:function(b){var a=b.pageOffset,c=this.offset.top+b.frameOffset.top;if(c+this.dim.height<a)return 1;if(c>a+b.height)return-1;return 0},setCount:function(b){this.options.count=b},bindDrain:function(b){if(!this.clickEvent)this.$el.attr("data-action")=="load-queued-posts"?this.$el.bind("click",
b):this.$el.delegate("[data-action=load-queued-posts]","click",b),this.clickEvent=!0},render:function(){var b=this;if(b.options.count===0)return void b.$el.hide();b.$el.html(DISQUS.renderBlock("realtimeCommentNotification",{comments:b.options.count}));b.bindDrain(function(){b.model.queue.drain();b.setCount(b.model.queue.length);b.render()});m.getInstance().on("domReflow",_.throttle(function(){if(b.options.count!==0)this.offset=b.$el.offset(),this.dim=b.$el.dim()},400),this);b.$el.show()}}),K=C.extend({getDirection:function(b){this.offset=
this.options.postView.offset;this.dim=this.options.postView.dim;b=C.prototype.getDirection.call(this,b);delete this.offset;delete this.dim;return b},render:function(){var b=this,a=b.options.postView;DISQUS.log("Model:",b.model.id);b.options.count===0?(b.$el.hide(),a.trackPosition=!1):(a.trackPosition=!0,b.$el.html(DISQUS.renderBlock("realtimeReplyNotification",{replies:b.options.count})),b.bindDrain(function(){b.options.thread.queue.drain(b.model.id);b.setCount(b.options.thread.queue.length);a.trackPosition=
!1;b.render()}),b.$el.show(),_.delay(function(){b.$el.addClass("reveal")},13))}}),M=Backbone.View.extend({render:function(){var b=this.model.usersTyping.count(),a=this.options.parentView.reply;a&&a.isOpen()&&(b-=1);if(b<=0)return void this.$el.hide();b==1?this.$el.html("One other user is typing&hellip;"):this.$el.html(b+" other users are typing&hellip;");this.$el.show()}}),L=l.extend({tagName:"ul",initialize:function(){this.collection.bind("reset",this.render,this)},render:function(){this.updateDom(function(){var b=
this;b.$el.empty();b.collection.length?b.collection.each(function(a){a=DISQUS.renderBlock("notification",{rawHtmlContent:a.get("formatted").text,timeAgo:moment(a.get("timestamp")).fromNow()});b.$el.append($(a))}):b.$el.text("You have no new notifications.");this.trigger("render")},this);return this}}),I=l.extend({tagName:"ul",className:"loading",initialize:function(b){this.collection.bind("reset",this.render,this);this.session=b.session},render:function(){this.updateDom(function(){this.$el.removeClass("loading");
this.$el.empty();this.collection.each(function(b){this.$el.append(DISQUS.renderBlock("activityItem",{activity:b.toJSON(),session:this.session?this.session.toJSON():null}))},this);this.trigger("render")},this);return this}}),P=Backbone.View.extend({initialize:function(b){var a=this;a.notifications=new L({collection:b.notifications});a.activity=new I({collection:new i.PostActivityCollection,session:g.session});Backbone.when([a.notifications,"render"],[a.activity,"render"]).then(function(){a.isRendered=
!0;a.trigger("render:all")});a.render();a.fetched=!1},render:function(){this.$el.html(DISQUS.renderBlock("dashboard"));this.$el.find("[data-role=notifications]").append(this.notifications.el).show();this.$el.find("[data-role=activity]").append(this.activity.el).show()},show:function(){if(!this.fetched)this.activity.collection.fetch(),this.fetched=!0,this.notifications.collection.markRead()}}),T=l.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){this.updateDom(this.render,
this)},this)},render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(b){var a=DISQUS.assureOffset(b.get("createdAt"));this.$el.append(DISQUS.renderBlock("topThread",{id:b.id,title:b.get("title"),url:b.get("link"),numPosts:b.get("postsInInterval"),numLikes:b.get("likes"),timeAgo:moment(a,DISQUS.ISO_8601).fromNow()}))},this);this.trigger("render")},this);this.attachPosts();return this},attachPosts:function(){this.collection.each(function(b){this.renderPost(b)},
this)},renderPost:function(b){var a=b.get("topPost");if(a){var c=_.strip(a.message),c=_.truncate(c,160,"&hellip;"),d=DISQUS.renderBlock("topThreadPost",{message:c,author:a.author});this.updateDom(function(){this.$el.find("[data-role=thread-"+b.id+"] [data-role=top-thread-post]").html(d)},this)}}}),U=l.extend({tagName:"ol",className:"loading",initialize:function(){this.collection.bind("reset",function(){g.thread.users.add(this.collection.models,{merge:!0});this.updateDom(this.render,this)},this)},
render:function(){this.updateDom(function(){this.$el.removeClass("loading");this.$el.empty();this.collection.each(function(b){this.$el.append(DISQUS.renderBlock("topUser",{user:b.toJSON()}))},this);this.trigger("render")},this);return this}}),Q=Backbone.View.extend({initialize:function(b){var a=this;a.forum=b.forum;a.topThreads=new T({id:"top-threads",collection:new i.TopThreadCollection(null,{forum:a.forum.id,limit:10})});a.topUsers=new U({id:"top-users",collection:new i.TopUserCollection(null,{forum:a.forum.id,
limit:20,discardLowRep:g.switches.enabled("next_discard_low_rep")})});Backbone.when([a.topUsers,"render"],[a.topThreads,"render"]).then(function(){a.isRendered=!0;a.trigger("render:all")});a.fetched=!1;a.render()},render:function(){this.$el.html(DISQUS.renderBlock("community",{forum:this.forum.toJSON()}));this.$el.find("[data-role=top-threads]").append(this.topThreads.el);this.$el.find("[data-role=top-users]").append(this.topUsers.el);return this},show:function(){if(!this.fetched)this.topThreads.collection.fetch(),
this.topUsers.collection.fetch(),this.fetched=!0}}),ba=l.extend({initialize:function(b){this.$el.addClass("loading");this.thread=b.thread;this.session=b.session;this.collection.on("add reset",this.render,this)},render:function(b,a,c){var d=this,e=(c&&c.index!=null?[d.collection.at(c.index)]:d.collection).map(function(b){b=new V({model:b,thread:d.thread,session:d.session});b.render();return b.el});d.updateDom(function(){d.$el.removeClass("loading");d.$el.append(e);d.isRendered=!0;d.trigger("render:all")})},
show:function(){this.collection.length>0||this.collection.fetch()}}),k={toggleFollow:function(b){b.preventDefault();this.user.get("isFollowing")?(this.user.unfollow(),$(b.target).removeClass("active")):($(b.target).addClass("active"),this.user.follow(),g.trigger("uiAction:followUser"))}},G=Backbone.View.extend({events:{"click [data-action=close]":"close","click [data-action=toggleFollow]":"toggleFollow"},initialize:function(b){var a=this;a.user=b.user;a.session=b.session;a.user.get("numFollowers")===
null&&a.user.fetch({success:function(){a.updateStats()}});a.user.on("change",a.updateStats,a);a.user.on("change:connections",a.updateConnections,a);a.user.on("change:isFollowing",a.updateActions,a);a.activity=new I({id:"activity",collection:new i.ActivityCollection(null,{user:a.user,include:"user"}),session:a.session});a.activity.on("render",function(){a.isRendered=!0;a.trigger("render:all")});a.render()},updateStats:function(){this.$el.find("[data-role=profile-stats]").html(DISQUS.renderBlock("profileStats",
{user:this.user.toJSON()}))},updateActions:function(){this.$el.find("[data-role=actions]").html(DISQUS.renderBlock("profileActions",{user:this.user.toJSON(),sessionId:this.session.user.id}))},updateConnections:function(){DISQUS.blocks.profileConnections&&this.$el.find("[data-role=connections]").html(DISQUS.renderBlock("profileConnections",{user:this.user.toJSON()}))},close:function(){this.trigger("close")},render:function(){this.$el.empty();this.$el.append(DISQUS.renderBlock("profile",{user:this.user.toJSON(),
sessionId:this.session.user.id}));this.$el.find("[data-role=activity]").append(this.activity.el)},show:function(){this.activity.collection.fetch()}});_.extend(G.prototype,k);var s=l.extend({initialize:function(){this._id=_.uniqueId();this._hoverState="out";this._leaveTimeout=this._enterTimeout=null;s.open={}},bindEvents:function(){var a=this;a.$el.bind("mouseover",function(){a.enter()});a.$el.bind("mouseout",function(){a.leave()})},target:function(a){var c=this;a.bind("mouseover",function(){c.enter(a)});
a.bind("mouseout",function(){c.leave()})},enter:function(a){var c=this;if(a)this.$target=a;c._leaveTimeout&&clearTimeout(c._leaveTimeout);if(c._hoverState!=="in")c._hoverState="in",c._enterTimeout=_.delay(function(){c._hoverState==="in"&&c.show();c._enterTimeout=null},s.DELAY_ENTER),s.open[this.uid]=this},leave:function(){var a=this;a._enterTimeout&&clearTimeout(a._enterTimeout);if(a._hoverState!=="out")a._hoverState="out",a._leaveTimeout=_.delay(function(){a._hoverState==="out"&&a.hide();a._leaveTimeout=
null},s.DELAY_LEAVE),s.open[this.uid]&&delete s.open[this.uid]},show:function(){this.$target.append(this.el)},hide:function(){this.$el.remove()}},{open:{},instances:{},DELAY_ENTER:350,DELAY_LEAVE:175,exitAll:function(){_.invoke(s.open,"leave")},create:function(a,c,d,e){var f=s.instances[d];f||(s.instances[d]=f={});d=f[a];d||(d=new e(c),f[a]=d,d.render());d.target(c.targetElement);return d}});(function(){$(document).bind("mouseout",_.debounce(function(a){a=a.relatedTarget||a.toElement;(!a||a.nodeName===
"HTML")&&s.exitAll()}),10)})();var E=s.extend({events:{"click [data-action=toggleFollow]":"toggleFollow"},initialize:function(a){var c=this;s.prototype.initialize.call(c,a);c.session=a.session;c.user=a.user;c.user.on("change:numPosts change:numLikesReceived",_.debounce(function(){c.updateCounters()}));c.user.on("change:isFollowing",function(){c.updateActions()});c.session.on("change:id",function(){c.render()})},render:function(){var a=this.user.toJSON();if(a.about)a.about=_.truncate(a.about,80,"...");
this.setElement($(DISQUS.renderBlock("hovercard",{user:a,sessionId:this.session.user.id})));this.bindEvents()},updateCounters:function(){var a=this.$el.find("[data-role=counters]");this.updateDom(function(){a.html(DISQUS.renderBlock("hovercardCounters",{user:this.user.toJSON(),sessionId:this.session.user.id}))},this)},updateActions:function(){var a=this.$el.find("[data-role=actions]");this.updateDom(function(){a.html(DISQUS.renderBlock("hovercardActions",{user:this.user.toJSON(),sessionId:this.session.user.id}))},
this)},show:function(){this.user.get("numLikesReceived")===null&&this.user.fetch();s.prototype.show.call(this)}},{create:function(a){return s.create(a.user.id,a,"ProfileCard",E)}});_.extend(E.prototype,k);var H=s.extend({initialize:function(a){s.prototype.initialize.call(this,a);this.post=a.post},render:function(){var a=this.post.toJSON();a.excerpt=_.truncate(_.strip(a.message),40,"...");this.setElement($(DISQUS.renderBlock("contextCard",{post:a})));this.bindEvents()}},{create:function(a){if(DISQUS.blocks.contextCard)return s.create(a.post.id,
a,"ContextCard",H)}}),V=l.extend({events:{"click [data-action=remove]":"destroyReaction"},initialize:function(a){this.thread=a.thread;this.session=a.session;this.session.on("change:id",this.renderMenu,this)},render:function(){this.setElement($(DISQUS.renderBlock("reaction",{reaction:this.model.toJSON(),thread:this.thread.toJSON()})))},renderMenu:function(){var a=this.$el.find("[data-role=menu]"),c=DISQUS.renderBlock("reactionMenu",{thread:this.session.toJSON().thread});this.updateDom(function(){a.html(c)},
this)},destroyReaction:function(a){a&&a.preventDefault&&a.preventDefault();this.model.destroy();this.updateDom(function(){this.remove()},this)}}),N=l.extend({events:{"click [data-action=dismiss]":"dismiss"},initialize:function(a){_.extend(this,a)},render:function(){this.setElement($(DISQUS.renderBlock("alert",{message:this.message,type:this.type,safe:this.safe})));return this},dismiss:function(a){a&&a.preventDefault&&a.preventDefault();this.remove();this.trigger("dismiss")}}),S=l.extend({events:{"click [data-action=cancel]":"cancel"},
initialize:function(){var a=this;a.loading=!1;if(!a.model.get("ipAddress"))a.loading=!0,a.model.on("change:ipAddress",function u(){a.model.off("change:ipAddress",u);a.loading=!1;a.redraw()}),a.model.fetch()},render:function(){var a=this;a.setElement($(DISQUS.renderBlock("blacklist",{loading:this.loading,post:a.model.toJSON()})));a.$el.bind("submit",function(c){c&&c.preventDefault()&&c.preventDefault();a.submit()});return a},redraw:function(){var a=this.el.parentNode;a&&(this.render(),this.updateDom(function(){$(a).empty().append(this.el)},
this))},cancel:function(a){a&&a.preventDefault()&&a.preventDefault();this.trigger("cancel")},submit:function(){var a={},c=this;c.$el.find("input").each(function(){if(this.checked)a[this.name]=this.value});if(!_.isEmpty(a))a.forum=c.model.get("forum"),DISQUS.api.call("blacklists/add.json",{method:"POST",data:a,success:function(){c.trigger("success")}})}}),D=l.extend({events:{keyup:"handleKeychange",paste:"handleKeychange"},render:function(){var a=this;a.$el.autoresize({maxHeight:350});a.$el.bind("resize",
_.throttle(function(){_.delay(_.bind(a.updateDom,a),200)},500));return a},resize:function(){this.$el.trigger("paste")},get:function(){return this.$el.val()},set:function(a){this.$el.val(a)},clear:function(){this.set("")},focus:function(){this.el.focus()},handleKeychange:function(){this.trigger("keychange")}}),z=D.extend({initialize:function(a){a=a||{};this.thread=a.thread;this.mentionsCache=new i.UserCollection;this.suggestions=new W({thread:a.thread,mentions:this.mentionsCache});this.placeholder=
"";this.suggestions.on("select",this.insertMention,this);this.reset()},reset:function(){this.searchTerms=this.anchorOffset=this.anchorNode=null;this.suggestions.clear()},render:function(){var a=this.el.placeholder,c=document.createElement("div");_.extend(c,{className:"textarea",contentEditable:!0,innerHTML:this.el.value,tabIndex:this.el.tabIndex});c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");var d=this.el.parentNode;d.replaceChild(c,this.el);this.setElement(c);this.bindKeyEvents();
d.appendChild(this.suggestions.el);this.content=new Editable(this.el);D.prototype.render.call(this);if(a)this.placeholder='<span class="placeholder">'+a+"</span>",this.$el.html()||this.$el.html(this.placeholder),this.$el.bind("focus",_.bind(function(){this.isPlaceholder()&&this.$el.empty()},this)),this.$el.bind("blur",_.bind(function(){this.content.text()===""&&this.$el.html(this.placeholder)},this));return this},isPlaceholder:function(){return this.$el.find(".placeholder").length!==0},bindKeyEvents:function(){this.$el.bind("keydown",
_.bind(function(a){switch(a.keyCode){case 9:this.suggestions.active&&(this.suggestions.select(),a.preventDefault(),a.stopPropagation());break;case 10:case 13:case 38:case 40:this.suggestions.active&&(a.preventDefault(),a.stopPropagation())}},this));var a=_.throttle(_.bind(this.suggest,this),500);this.$el.bind("keyup",_.bind(function(c){c.preventDefault();c.stopPropagation();this.checkExistingMentions();switch(c.keyCode){case 50:if(!c.shiftKey)break;this.start(c);break;case 10:case 13:this.suggestions.select();
break;case 27:this.reset(c);break;case 38:this.suggestions.move("up");break;case 40:this.suggestions.move("down");break;default:a(c)}},this))},start:function(){this.reset();this.suggest()},suggest:function(){this.suggestions.suggest(this.parseSearchTerms())},insertMention:function(a){var c=this.thread.users.getByCid(a);this.selectSearchString(c);this.mentionsCache.getByCid(a)||this.mentionsCache.add(c);this.content.insertHTML(z.getMentionHtml(c));a=this.$el.find("span[data-cid]");_.each(a,function(a){if(a.contentEditable!==
!1)a.contentEditable=!1})},selectSearchString:function(){this.content.selectNodeText(this.anchorNode,this.anchorOffset-1,this.anchorOffset+Editable.normalizeSpace(this.anchorNode.nodeValue.slice(this.anchorOffset)).toLowerCase().length)},get:function(){var a=this,c=z.isMention;if(this.isPlaceholder())return"";return this.content.text(function(d){return c(d,!0)?a.mentionToText(d):null})},set:function(a){this.el.innerHTML=a},parseSearchTerms:function(){var a=this.content.selectedTextNode(),c=a?a.nodeValue:
"",d=Editable.normalizeSpace;if(c){var e=this.content.selectedTextNodeOffset(a),f=Editable.normalizeSpace(c.slice(0,e).split("").reverse().join("")).indexOf("@");if(f===-1)return null;this.anchorNode=a;this.anchorOffset=e-f;if(a=d(c.slice(this.anchorOffset-1,e)).match(z.MENTIONS_RE))return a[0].slice(1).split(" ");if(f===0)return[""]}},checkExistingMentions:function(){var a=Editable.normalizeSpace,c=this.$el.find("span"),c=_.filter(c,z.isMention),d=this.mentionsCache,e={};_.each(c,function(c){var f=
$(c).attr("data-cid"),g=_.reduce(this.content.getTextNodes(c),function(c,d){return c+a(d.nodeValue)},""),h=d.getByCid(f);h.get("name")!==g?(this.mentionsCache.remove(h),this.content.removeNode(c),this.content.insertHTML(" "),this.reset()):e[f]=c},this);d.each(function(a){e[a.cid]||d.remove(a)})},mentionToText:function(a){a=this.mentionsCache.getByCid($(a).attr("data-cid"));return["@",a.get("username")||a.get("emailHash"),":disqus"].join("")}},{MENTIONS_RE:/@\w+\s?(?:\w+\s?){0,5}(?:\w+)?$/,isMention:function(a,
c){var d;do{d=$(a);if(d.hasClass("mention")&&d.attr("data-cid"))return!0;a=a.parentElement}while(c&&a);return!1},getMentionHtml:function(a){return'<span contenteditable="true"><span contenteditable="false" data-cid="'+a.cid+'" class="mention">'+a.get("name")+"</span></span>&nbsp;"}}),W=Backbone.View.extend({events:{"click li":"onclick"},initialize:function(a){this.active=!1;this.thread=a.thread;this.mentionsCache=a.mentions},suggest:function(a){a=this.findMatches(a);if(!a||!a.length)return void this.clear();
this.active=!0;this.el.innerHTML=DISQUS.renderBlock("suggestions",{users:_.map(a,function(a){return _.extend(a.toJSON(),{cid:a.cid})})});this.$el.find("li[data-cid]").first().addClass("active")},clear:function(){this.active=!1;this.el.innerHTML=""},onclick:function(a){this.select($(a.currentTarget).attr("data-cid"))},findMatches:function(a){if(a&&a.length){for(var c=RegExp(a.join(" ").replace(/[^\w\s]/,""),"i"),d=W.MAX_SUGGESTIONS,e=this.thread.users,f=[],g=0,i,a=a.length===1&&a[0]===""?function(){return!0}:
function(a){return c.test(a.get("name"))||c.test(i.get("username"))},g=0;g<e.models.length&&f.length<d;g++)i=e.models[g],this.mentionsCache.getByCid(i.cid)||a(i)&&f.push(i);return f}},select:function(a){this.active&&(a||(a=this.$el.find(".active").attr("data-cid")),this.trigger("select",a),this.clear())},move:function(a){if(this.active){var c=this.$el.find(".active"),a=c[a==="up"?"previous":"next"]();a.length&&a.attr("data-cid")&&(c.removeClass("active"),a.addClass("active"))}}},{MAX_SUGGESTIONS:5}),
O=l.extend({tagName:"ul",className:"debug",initialize:function(a){this.values=a},render:function(){this.$el.empty();_.each(this.values,function(a,c){var d=document.createElement("li");d.innerHTML="<strong>"+c+"</strong>: "+a;this.$el.append(d)},this);return this}}),R=Backbone.View.extend({events:{"click [data-nav]":"_navTo"},initialize:function(){this.prevDestination=this.activeNav()},_navTo:function(a){a.preventDefault();a=$(a.target);a=a.is("[data-nav]")?a:a.closest("[data-nav]");a=a.attr("data-nav");
if(this.prevDestination==a)return!1;this.navTo(a)},navTo:function(a){this.prevDestination=a;var c=this.$el.find("[data-nav="+a+"]").parent();c.siblings("li").removeClass("active");c.addClass("active");this.trigger("nav",a)},activeNav:function(){if(this.prevDestination!=null)return this.prevDestination;return this.$el.find(".active [data-nav]").attr("data-nav")},clear:function(){this.$el.find("li").removeClass("active");this.prevDestination=null}});return{Lounge:m,LoungeSubView:l,PostView:r,PostReplyView:v,
PostEditView:B,ReactionView:V,UserMenuView:x,ThreadMenuView:q,QueuedPostView:C,QueuedReplyView:K,TypingUserView:M,CommunityView:Q,TopThreadCollectionView:T,TopUserCollectionView:U,DashboardView:P,NotificationCollectionView:L,NotificationCountView:J,ActivityCollectionView:I,ProfileView:G,HoverCard:s,ProfileCard:E,ContextCard:H,CaptchaView:n,AlertView:N,BlacklistView:S,ContentEditableView:z,DebugInfoView:O}});var _qevents,_comscore,_gaq;
(function(a){var e="",e="UA-1410476-6",i=a.getElementsByTagName("script")[0],j=i.parentNode,f=a.location.protocol=="https:";_qevents=_qevents||[];_comscore=_comscore||[];var d=a.createElement("script");d.type="text/javascript";d.async=!0;d.src=(f?"https://secure":"http://edge")+".quantserve.com/quant.js";j.insertBefore(d,i);_qevents.push({qacct:"p-94WKwgUwZHlfo"});_comscore.push({c1:"7",c2:"10137436",c3:"1"});d=document.createElement("script");d.async=!0;d.src=(f?"https://sb":"http://b")+".scorecardresearch.com/beacon.js";
j.insertBefore(d,i);_gaq=_gaq||[];_gaq.push(["_setAccount",e]);_gaq.push(["_setDomainName",".disqus.com"]);a=a.createElement("script");a.type="text/javascript";a.async=!0;a.src=(f?"https://ssl":"http://www")+".google-analytics.com/ga.js";j.insertBefore(a,i)})(document);
DISQUS.define("ga",function(a){var e,i=function(f){e?e(f):a._gaq.push(f)},j={component:1,"package":2,forum:3,version:4,userType:5};return{setCaller:function(a){e=a},setAccount:function(a){i(["_setAccount",a])},setCustomVar:function(a,d){i(["_setCustomVar",j[a],a,d])},trackPageview:function(){i(["_trackPageview"])},trackEvent:function(a,d,c){i(["_trackEvent",d,a,c,1])},setDomainName:function(a){i(["_setDomainName",a])}}});
DISQUS.define("juggler",function(a){var e,i,j={},f=["thread","forum","forum_id"],d=f.slice().concat(["imp","event"]),c=[],g=(new Date).getTime().toString(10)+Math.floor(Math.random()*1E6).toString(10);return{load:function(d){a.location.href.slice(0,5)=="https"?e=function(){}:(DISQUS.cookies.create("__jid",g,{expiresIn:18E5}),i=d.url,DISQUS.each(f,function(a){j[a]=d[a]}),j.imp=g,e=function(a){DISQUS.each(j,function(c,d){a[d]=j[d]});DISQUS.require(i,a,!1)},DISQUS.each(c,function(a){e(a)}))},emit:function(a,
f){DISQUS.each(d,function(a){if(f[a]!=null)throw"Error: cannot overwrite event context '"+a+"'";});f.event=a;e==null?c.push(f):e(f)},impId:g}});
DISQUS.define("intelligence",function(a){function e(a,e){function f(a){if(!(a instanceof DISQUS.lounge.models.User)&&!(a instanceof DISQUS.lounge.models.AnonUser))throw Error("determineUserType(user) needs an instance of User/Anonuser");return a.has("remote")?a.get("remote").domain:a.id?"disqus":q?"guest":"not_logged_in"}function d(a){if(e.switches.length>0)a(e.switches);else e.switches.on("reset",a)}var c=e.initialData;if(_.isObject(c)&&!_.isEmpty(c)){var g=DISQUS.ga.setCustomVar,o=DISQUS.ga.trackPageview,
k=function(a){DISQUS.ga.trackEvent(a,p,m)},p="next",m=c.forum.id,l="not_logged_in",q=!1,x=c.features.support_preferred?"plus":c.features.support_priority?"pro":c.features.support_vip?"vip":"free";e.session.on("identify",function(){var t=this.user;d(function(d){d.enabled("juggler_thread_onReady")&&DISQUS.juggler.emit("init_embed",{thread_slug:c.thread.slug,user_type:t.get("user_type")||"anon",referrer:a.document.referrer,theme:"next",prev_imp:DISQUS.cookies.read("__jid")})});l=f(t);g("component","embed");
g("package",x);g("forum",m);g("version",p);g("userType",l);o();e.session.on("change:id",function(a){var c=l;l=f(a);c!=l&&(g("userType",l),k(l=="not_logged_in"||l=="guest"?"logout":"login"))})});d(function(d){d.enabled("juggler_enabled")&&!d.enabled("next_disable_ssl_juggler")&&(d="http://juggler.services.disqus.com/event.js",a.location.protocol==="http:"&&(d=d.replace("http:","https:")),DISQUS.juggler.load({url:d,thread:c.thread.id,forum:c.forum.id,forum_id:c.forum.pk}))});DISQUS.each({inViewport:function(){k("view_embed");
e.off("inViewport")},"uiAction:createPost":function(a){l=="not_logged_in"&&(l="guest",g("userType",l));q=!0;a.get("parent")!=null?k("post_comment_reply"):k("post_comment")},"uiAction:postUpvote":function(){k("like_comment")},"uiAction:postDownvote":function(){k("dislike_comment")},"uiAction:threadUpvote":function(){k("like_thread")},"uiAction:postShare":function(a){k("share_comment_"+a)},"uiAction:threadShare":function(a){k("share_thread_"+a)},"uiAction:navigate":function(a){(a={community:"community",
dashboard:"mydisqus",profile:"profile",reactions:"reactions"}[a])&&k("open_"+a)},"uiAction:followUser":function(){k("follow_user")}},function(a,c){e.on(c,a)})}}return{init:function(i){e(a,i)}}});
(function(){DISQUS.log=function(){var a=DISQUS.lounge.views.Lounge.getInstance();window.console&&a&&a.switches&&a.switches.enabled("next_logging")&&(window.console.log.apply?window.console.log.apply(window.console,arguments):window.console.log(Array.prototype.slice.call(arguments,0).join(" ")))};DISQUS.logError=function(){var a=DISQUS.lounge.views.Lounge.getInstance(),e=Array.prototype.slice.call(arguments,0);DISQUS.log.apply(DISQUS,e);a.switches&&a.switches.enabled("next_raven")&&a.states.ravenConfigured&&
Raven.captureMessage({name:"DISQUS.logError",message:e.join(" ")})};$(document).ready(function(){function a(){$(".dropdown").removeClass("open")}$("html").bind("click",a);$("body").delegate("[data-toggle]","click",function(e){e.stopPropagation();e.preventDefault();var e=$(e.currentTarget),e=e.closest("."+e.attr("data-toggle")),i=e.attr("data-dropdown")!="disabled"&&!e.hasClass("open");e.attr("data-dropdown","enabled");a();i&&e.addClass("open")});DISQUS.Bus.bind("window.click",a)})})();